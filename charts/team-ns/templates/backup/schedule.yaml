
{{- $v := .Values }}
{{- $b := $v.backup }}
{{- if $v.apps.velero.enabled }}
{{- if $b.enabled }}
apiVersion: velero.io/v1
kind: Schedule
metadata:
  name: team-{{ $v.teamId }}-backup-schedule
  namespace: velero
spec:
  schedule: {{ $b.schedule }}
  template:
    includedNamespaces:
    - team-{{ $v.teamId }}
    includedResources: {{- toYaml $b.includedResources | nindent 4 }}
    includeClusterResources: false
    {{- if hasKey $b "labelSelector" }}
    labelSelector:
      matchLabels: {{- toYaml $b.labelSelector | nindent 6 }}
    {{- end }}
    snapshotVolumes: {{ $b.snapshotVolumes }}
    storageLocation: otomi
    volumeSnapshotLocations:
      - otomi
{{- end }}
{{- end }}