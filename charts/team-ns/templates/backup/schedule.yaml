
{{- $v := .Values }}
{{- if $v.apps.velero.enabled }}
{{- range $v.backups }}
---
apiVersion: velero.io/v1
kind: Schedule
metadata:
  name: team-{{ $v.teamId }}-backup-{{ .name }}
  namespace: velero
spec:
  schedule: {{ .schedule }}
  template:
    includedNamespaces:
    - team-{{ $v.teamId }}
    includedResources: {{- toYaml .includedResources | nindent 4 }}
    ttl: {{ .ttl }}
    includeClusterResources: false
    {{- if hasKey . "labelSelector" }}
    labelSelector:
      matchLabels: {{- toYaml .labelSelector | nindent 8 }}
    {{- end }}
    snapshotVolumes: {{ .snapshotVolumes }}
    storageLocation: otomi
    volumeSnapshotLocations:
      - otomi
{{- end }}
{{- end }}