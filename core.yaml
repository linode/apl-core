# NOTE: This file is merged with other values in ./helmfile.d/snippets/env.gotmpl
apps:
  alertmanager: {}
  drone: {}
  gitea: {}
  grafana: {}
  grafana-istio: {}
  harbor: {}
  httpbin: {}
  keycloak: {}
  kiali: {}
  kubeapps: {}
  loki: {}
  prometheus: {}
  prometheus-istio: {}
  sitespeed: {}
  tracing: {}
  vault: {}
  weave-scope: {}

k8s:
  namespaces:
    - name: default
      disableIstioInjection: true
      disablePolicyChecks: true
    - name: drone-pipelines
      disableIstioInjection: true
      disablePolicyChecks: true
    - name: harbor
    - name: gitea
    - name: istio-system
      disableIstioInjection: true
    - name: ingress
      disableIstioInjection: true
    - name: istio-apps
    - name: keycloak
    - name: knative-serving
      disableIstioInjection: true
      disablePolicyChecks: true
    - name: kubeapps
      disableIstioInjection: true
    - name: kube-system
      disableIstioInjection: true
      disablePolicyChecks: true
    - name: maintenance
      disableIstioInjection: true
    - name: monitoring
    - name: operator-lifecycle-manager
      disableIstioInjection: true
      disablePolicyChecks: true
    - name: otomi
    - name: overprovisioner
      disableIstioInjection: true
    - name: shared
    - name: team-admin
    - name: vault

services:
  - name: keycloak
    namespace: keycloak
    svc: keycloak-http
    ownHost: true
    isPublic: true
  - name: httpbin
    namespace: shared
    svc: httpbin
    ownHost: true
    isShared: true
  - name: harbor
    svc: harbor-harbor-portal
    namespace: harbor
    ownHost: true
    paths: [/]
    isShared: true
  - name: harbor
    svc: harbor-harbor-core
    namespace: harbor
    ownHost: true
    paths: [/api/, /c/, /chartrepo/]
    forwardPath: true
    hide: true
    isShared: true
  - name: harbor
    svc: harbor-harbor-core
    namespace: harbor
    ownHost: true
    paths: [/service/, /v1/, /v2/]
    forwardPath: true
    hide: true
    isPublic: true
  - name: gitea
    namespace: gitea
    svc: gitea-http
    ownHost: true
    isShared: true
    port: 3000
    paths: [/api/, /otomi/values, /otomi-admin/values, /login/oauth]
    forwardPath: true
    isPublic: true
  - name: gitea
    namespace: gitea
    svc: gitea-http
    ownHost: true
    isShared: true
    port: 3000
    hide: true
  - name: notary
    svc: harbor-harbor-notary-server
    port: 4443
    namespace: harbor
    ownHost: true
    hide: true
    isShared: true
  - name: otomi
    namespace: otomi
    ownHost: true
    isShared: true
    svc: otomi-api
    hide: true
    paths: [/api/]
  - name: otomi
    namespace: otomi
    ownHost: true
    isShared: true
    svc: otomi-console
    paths: [/]
  - name: loki
    svc: po-grafana
    host: grafana # this service is only specified to generate an icon on the dashboard that opens grafana's loki view
    namespace: monitoring
    path: 'explore?orgId=1&left=%5B"now-1h","now","Loki",%7B%7D,%7B"mode":"Logs"%7D,%7B"ui":%5Btrue,true,true,"none"%5D%7D%5D'
  - name: weave-scope
    svc: weave-scope
    namespace: monitoring
  - name: grafana
    svc: po-grafana
    namespace: monitoring
    # specifying authz will strip the bearer token by default, unless forwardOriginalToken=true
    # this mechanism allows us to not bother services that need the same "Bearer" header for their own oidc
    # it also adds an in-cluster enforcement that only payloads containing the right authn may access it
    authz:
      workload:
        app.kubernetes.io/instance: prometheus-operator
        app.kubernetes.io/name: po-grafana
  - name: grafana-istio
    svc: grafana
    port: 3000
    logo:
      name: istio
    namespace: istio-apps
    authz:
      workload:
        app: grafana
        release: istio-system
  - name: prometheus
    svc: po-prometheus
    port: 9090
    namespace: monitoring
  - name: prometheus-istio
    svc: prometheus
    ownHost: true
    port: 9090
    logo:
      name: prometheus
    namespace: istio-apps
  - name: alertmanager
    svc: po-alertmanager
    port: 9093
    logo:
      name: prometheus
    namespace: monitoring
  - name: kiali
    svc: kiali
    forwardPath: true
    port: 20001
    namespace: kiali
  - name: tracing
    svc: tracing
    forwardPath: true
    logo:
      name: jaeger
    namespace: istio-apps
  - name: drone
    svc: drone
    namespace: team-admin
    ownHost: true
    authz:
      workload:
        app: drone
        component: server
  - name: drone
    svc: drone
    namespace: team-admin
    ownHost: true
    hide: true
    isPublic: true
    paths: [/hook, /api/user, /api/repo]
    forwardPath: true
  - name: vault
    namespace: vault
    svc: vault-0
    port: 8200
    ownHost: true
    logo:
      name: vault
    isShared: true
    path: ui/vault/auth?with=oidc
  - name: kubeapps
    svc: kubeapps
    namespace: kubeapps
    ownHost: true
    logo:
      name: kubernetes
    isPublic: true
    isShared: true

teamConfig:
  services:
    - name: harbor
      svc: harbor-harbor-portal
      namespace: harbor
      isShared: true
      host: harbor
    - name: httpbin
      namespace: shared
      svc: httpbin
      isShared: true
      host: httpbin
    - name: vault
      namespace: vault
      svc: vault-0
      port: 8200
      host: vault
      logo:
        name: vault
      isShared: true
      path: ui/vault/secrets/secret/list/teams/#NS#/
    - name: kubeapps
      namespace: kubeapps
      svc: kubeapps
      isShared: true
      host: kubeapps
      logo:
        name: kubernetes
    - name: loki
      svc: po-grafana
      host: grafana # this service is only specified to generate an icon on the dashboard that opens grafana's loki view
      path: explore?orgId=1&left=%5B%22now-1h%22,%22now%22,%22Loki%22,%7B%22expr%22:%22%7Bnamespace%3D%5C%22#NS#%5C%22%7D%22%7D,%7B%22mode%22:%22Logs%22%7D,%7B%22ui%22:%5Btrue,true,true,%22none%22%5D%7D%5D
    - name: grafana
      svc: po-grafana
      hasPrefix: true
      authz:
        workload:
          app.kubernetes.io/instance: prometheus-__TEAM
          app.kubernetes.io/name: __TEAM-po-grafana
    - name: prometheus
      svc: po-prometheus
      hasPrefix: true
      port: 9090
    - name: alertmanager
      svc: po-alertmanager
      hasPrefix: true
      port: 9093
      logo:
        name: prometheus

letsencryptCA: |
  -----BEGIN CERTIFICATE-----
  MIIFATCCAumgAwIBAgIRAKc9ZKBASymy5TLOEp57N98wDQYJKoZIhvcNAQELBQAw
  GjEYMBYGA1UEAwwPRmFrZSBMRSBSb290IFgxMB4XDTE2MDMyMzIyNTM0NloXDTM2
  MDMyMzIyNTM0NlowGjEYMBYGA1UEAwwPRmFrZSBMRSBSb290IFgxMIICIjANBgkq
  hkiG9w0BAQEFAAOCAg8AMIICCgKCAgEA+pYHvQw5iU3v2b3iNuYNKYgsWD6KU7aJ
  diddtZQxSWYzUI3U0I1UsRPTxnhTifs/M9NW4ZlV13ZfB7APwC8oqKOIiwo7IwlP
  xg0VKgyz+kT8RJfYr66PPIYP0fpTeu42LpMJ+CKo9sbpgVNDZN2z/qiXrRNX/VtG
  TkPV7a44fZ5bHHVruAxvDnylpQxJobtCBWlJSsbIRGFHMc2z88eUz9NmIOWUKGGj
  EmP76x8OfRHpIpuxRSCjn0+i9+hR2siIOpcMOGd+40uVJxbRRP5ZXnUFa2fF5FWd
  O0u0RPI8HON0ovhrwPJY+4eWKkQzyC611oLPYGQ4EbifRsTsCxUZqyUuStGyp8oa
  aoSKfF6X0+KzGgwwnrjRTUpIl19A92KR0Noo6h622OX+4sZiO/JQdkuX5w/HupK0
  A0M0WSMCvU6GOhjGotmh2VTEJwHHY4+TUk0iQYRtv1crONklyZoAQPD76hCrC8Cr
  IbgsZLfTMC8TWUoMbyUDgvgYkHKMoPm0VGVVuwpRKJxv7+2wXO+pivrrUl2Q9fPe
  Kk055nJLMV9yPUdig8othUKrRfSxli946AEV1eEOhxddfEwBE3Lt2xn0hhiIedbb
  Ftf/5kEWFZkXyUmMJK8Ra76Kus2ABueUVEcZ48hrRr1Hf1N9n59VbTUaXgeiZA50
  qXf2bymE6F8CAwEAAaNCMEAwDgYDVR0PAQH/BAQDAgEGMA8GA1UdEwEB/wQFMAMB
  Af8wHQYDVR0OBBYEFMEmdKSKRKDm+iAo2FwjmkWIGHngMA0GCSqGSIb3DQEBCwUA
  A4ICAQBCPw74M9X/Xx04K1VAES3ypgQYH5bf9FXVDrwhRFSVckria/7dMzoF5wln
  uq9NGsjkkkDg17AohcQdr8alH4LvPdxpKr3BjpvEcmbqF8xH+MbbeUEnmbSfLI8H
  sefuhXF9AF/9iYvpVNC8FmJ0OhiVv13VgMQw0CRKkbtjZBf8xaEhq/YqxWVsgOjm
  dm5CAQ2X0aX7502x8wYRgMnZhA5goC1zVWBVAi8yhhmlhhoDUfg17cXkmaJC5pDd
  oenZ9NVhW8eDb03MFCrWNvIh89DDeCGWuWfDltDq0n3owyL0IeSn7RfpSclpxVmV
  /53jkYjwIgxIG7Gsv0LKMbsf6QdBcTjhvfZyMIpBRkTe3zuHd2feKzY9lEkbRvRQ
  zbh4Ps5YBnG6CKJPTbe2hfi3nhnw/MyEmF3zb0hzvLWNrR9XW3ibb2oL3424XOwc
  VjrTSCLzO9Rv6s5wi03qoWvKAQQAElqTYRHhynJ3w6wuvKYF5zcZF3MDnrVGLbh1
  Q9ePRFBCiXOQ6wPLoUhrrbZ8LpFUFYDXHMtYM7P9sc9IAWoONXREJaO08zgFtMp4
  8iyIYUyQAbsvx8oD2M8kRvrIRSrRJSl6L957b4AFiLIQ/GgV2curs0jje7Edx34c
  idWw1VrejtwclobqNMVtG3EiPUIpJGpbMcJgbiLSmKkrvQtGng==
  -----END CERTIFICATE-----
