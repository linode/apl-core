toolsVersion: 1.3.5
redkubesSlackUrl: https://hooks.slack.com/services/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

k8s:
  namespaces:
    - name: drone-pipelines
      disableIstioInjection: true
    - name: ingress
    - name: keycloak
    - name: harbor
    - name: istio-system
      disableIstioInjection: true
    - name: knative-serving
    - name: kube-system
      disableIstioInjection: true
    - name: maintenance
      disableIstioInjection: true
    - name: monitoring
    - name: shared
    - name: team-admin

services:
  - name: keycloak
    namespace: keycloak
    ownHost: true
    svc: keycloak-http
    isShared: true
    isPublic: true
  - name: harbor
    svc: harbor-harbor-portal
    namespace: harbor
    isShared: true
    ownHost: true
    paths: [/]
  - name: harbor
    svc: harbor-harbor-core
    namespace: harbor
    isShared: true
    paths: [/api/, /c/, /chartrepo/, /service/]
    forwardPath: true
    hide: true
  - name: harbor
    svc: harbor-harbor-registry
    namespace: harbor
    isShared: true
    paths: [/v1/, /v2/]
    port: 5000
    forwardPath: true
    hide: true
    isPublic: true
  - name: notary
    svc: harbor-harbor-notary-server
    port: 4443
    namespace: harbor
    isShared: true
    hide: true
  - name: otomi
    namespace: shared
    svc: otomi-api
    hide: true
    paths: [/api/]
  - name: otomi
    namespace: shared
    svc: otomi-web
    authz:
      forwardOriginalToken: true
      workload:
        app.kubernetes.io/name: otomi-web
  - name: loki
    svc: po-grafana
    host: grafana # this service is only specified to generate an icon on the dashboard that opens grafana's loki view
    namespace: monitoring
    path: 'explore?orgId=1&left=%5B"now-1h","now","Loki",%7B%7D,%7B"mode":"Logs"%7D,%7B"ui":%5Btrue,true,true,"none"%5D%7D%5D'
  - name: scope
    svc: weave-scope
    namespace: monitoring
  - name: grafana
    svc: po-grafana
    namespace: monitoring
    authz:
      workload:
        app.kubernetes.io/instance: prometheus-operator
        app.kubernetes.io/name: po-grafana
  - name: grafana-istio
    svc: grafana
    port: 3000
    logo:
      name: istio
    namespace: istio-system
  - name: prometheus
    svc: po-prometheus
    port: 9090
    namespace: monitoring
  - name: prometheus-istio
    svc: prometheus
    ownHost: true
    port: 9090
    logo:
      name: prometheus
    namespace: istio-system
  - name: alertmanager
    svc: po-alertmanager
    port: 9093
    logo:
      name: prometheus
    namespace: monitoring
  - name: kiali
    svc: kiali
    forwardPath: true
    port: 20001
    namespace: istio-system
  - name: tracing
    svc: tracing
    forwardPath: true
    logo:
      name: jaeger
    namespace: istio-system
  - name: drone
    svc: drone
    namespace: team-admin
    ownHost: true
    authz:
      workload:
        app: drone
        component: server

proxies:
  - name: drone
    namespace: team-admin
    path: /hook

teamConfig:
  services:
    - name: otomi
      namespace: shared
      svc: otomi-api
      paths: [/api/]
      hide: true
    - name: otomi
      namespace: shared
      svc: otomi-web
      authz:
        forwardOriginalToken: true
        workload:
          app.kubernetes.io/name: otomi-web
    - name: loki
      svc: po-grafana
      host: grafana # this service is only specified to generate an icon on the dashboard that opens grafana's loki view
      path: explore?orgId=1&left=%5B%22now-1h%22,%22now%22,%22Loki%22,%7B%22expr%22:%22%7Bnamespace%3D%5C%22#NS#%5C%22%7D%22%7D,%7B%22mode%22:%22Logs%22%7D,%7B%22ui%22:%5Btrue,true,true,%22none%22%5D%7D%5D
    - name: grafana
      svc: po-grafana
      hasPrefix: true
      authz:
        workload:
          app.kubernetes.io/instance: prometheus-__TEAM
          app.kubernetes.io/name: __TEAM-po-grafana
    - name: prometheus
      svc: po-prometheus
      hasPrefix: true
      port: 9090
    - name: alertmanager
      svc: po-alertmanager
      hasPrefix: true
      port: 9093
      logo:
        name: prometheus
