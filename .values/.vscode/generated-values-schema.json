{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "type": "object",
  "additionalProperties": false,
  "definitions": {
    "alerts": {
      "properties": {
        "groupInterval": {
          "type": "string",
          "default": "5m"
        },
        "repeatInterval": {
          "type": "string",
          "default": "3h"
        },
        "receiver": {
          "type": "string",
          "enum": ["slack", "msteams"]
        },
        "slack": {
          "type": "object",
          "properties": {
            "url": {
              "type": "string"
            },
            "channel": {
              "type": "string",
              "default": "mon-otomi"
            }
          }
        },
        "msteams": {
          "type": "object",
          "properties": {
            "highPrio": {
              "type": "string"
            },
            "lowPrio": {
              "type": "string"
            }
          }
        }
      }
    },
    "cloud": {
      "properties": {
        "domain": { "type": "string" },
        "clusters": {
          "patternProperties": {
            "^[a-z-]+$": { "$ref": "#/definitions/cluster" }
          },
          "additionalProperties": false
        }
      }
    },
    "cluster": {
      "type": "object",
      "properties": {
        "apiName": {
          "type": "string"
        },
        "apiServer": {
          "type": "string"
        },
        "domain": {
          "type": "string"
        },
        "k8sVersion": {
          "type": "number"
        },
        "otomiVersion": {
          "type": "string"
        },
        "name": {
          "type": "string"
        },
        "provider": {
          "type": "string"
        },
        "region": {
          "type": "string"
        },
        "vpcID": {
          "type": "string"
        }
      }
    },
    "team": {
      "properties": {
        "azure": {
          "type": "object"
        },
        "id": {
          "type": "string"
        },
        "name": {
          "type": "string"
        },
        "oidc": {
          "oidc": {
            "properties": {
              "groupMapping": {
                "type": "string"
              }
            }
          }
        },
        "password": {
          "type": "string"
        },
        "services": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "isPublic": {
                "type": "boolean"
              },
              "name": {
                "type": "string"
              },
              "namespace": {
                "type": "string"
              },
              "ownHost": {
                "type": "boolean"
              },
              "svc": {
                "type": "string"
              },
              "isShared": {
                "type": "boolean"
              },
              "paths": {
                "type": "array",
                "items": {
                  "type": "string"
                }
              },
              "forwardPath": {
                "type": "boolean"
              },
              "hide": {
                "type": "boolean"
              },
              "port": {
                "type": "number"
              },
              "authz": {
                "type": "object",
                "properties": {
                  "forwardOriginalToken": {
                    "type": "boolean"
                  },
                  "workload": {
                    "type": "object",
                    "properties": {
                      "app.kubernetes.io/name": {
                        "type": "string"
                      },
                      "app.kubernetes.io/instance": {
                        "type": "string"
                      },
                      "app": {
                        "type": "string"
                      },
                      "component": {
                        "type": "string"
                      }
                    }
                  }
                }
              },
              "host": {
                "type": "string"
              },
              "path": {
                "type": "string"
              },
              "logo": {
                "type": "object",
                "properties": {
                  "name": {
                    "type": "string"
                  }
                }
              }
            }
          }
        }
      }
    }
  },
  "properties": {
    "alerts": { "$ref": "#/definitions/alerts" },
    "charts": {
      "type": "object",
      "properties": {
        "cert-manager": {
          "type": "object",
          "properties": {
            "email": {
              "type": "string"
            },
            "provider": {
              "type": "object",
              "properties": {
                "google": {
                  "type": "object",
                  "properties": {
                    "clouddns": {
                      "type": "object",
                      "properties": {
                        "project": {
                          "type": "string"
                        },
                        "serviceAccountSecretRef": {
                          "type": "object",
                          "properties": {
                            "key": {
                              "type": "string"
                            },
                            "name": {
                              "type": "string"
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            },
            "stage": {
              "type": "string"
            }
          }
        },
        "drone": {
          "type": "object",
          "properties": {
            "orgsFilter": {
              "type": "string"
            },
            "repoFilter": {
              "type": "string"
            },
            "server": {
              "type": "object",
              "properties": {
                "adminUser": {
                  "type": "string"
                }
              }
            },
            "sourceControl": {
              "type": "object",
              "properties": {
                "github": {
                  "type": "object",
                  "properties": {
                    "clientID": {
                      "type": "string"
                    },
                    "clientSecretValue": {
                      "type": "string"
                    },
                    "server": {
                      "type": "string"
                    }
                  }
                },
                "provider": {
                  "type": "string"
                }
              }
            }
          }
        },
        "external-dns": {
          "type": "object",
          "properties": {
            "domainFilters": {
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            "zoneIdFilters": {
              "type": "array",
              "items": {
                "type": "string"
              }
            }
          }
        },
        "gatekeeper-operator": {
          "type": "object",
          "properties": {
            "enabled": {
              "type": "boolean"
            }
          }
        },
        "harbor": {
          "type": "object",
          "properties": {
            "adminPassword": {
              "type": "string"
            },
            "enabled": {
              "type": "boolean"
            },
            "persistence": {
              "type": "object",
              "properties": {
                "imageChartStorage": {
                  "type": "object",
                  "properties": {
                    "gcs": {
                      "type": "object",
                      "properties": {
                        "bucket": {
                          "type": "string"
                        },
                        "encodedkey": {
                          "type": "string"
                        },
                        "rootdirectory": {
                          "type": "string"
                        }
                      }
                    },
                    "type": {
                      "type": "string"
                    }
                  }
                }
              }
            },
            "secretKey": {
              "type": "string"
            }
          }
        },
        "istio": {
          "type": "object",
          "properties": {
            "addonComponents": {
              "type": "object",
              "properties": {
                "grafana": {
                  "type": "object",
                  "properties": {
                    "enabled": {
                      "type": "boolean"
                    }
                  }
                },
                "kiali": {
                  "type": "object",
                  "properties": {
                    "enabled": {
                      "type": "boolean"
                    }
                  }
                },
                "prometheus": {
                  "type": "object",
                  "properties": {
                    "enabled": {
                      "type": "boolean"
                    }
                  }
                },
                "tracing": {
                  "type": "object",
                  "properties": {
                    "enabled": {
                      "type": "boolean"
                    }
                  }
                }
              }
            },
            "gateways": {
              "type": "object",
              "properties": {
                "istio-egressgateway": {
                  "type": "object",
                  "properties": {
                    "resources": {
                      "type": "object",
                      "properties": {
                        "limits": {
                          "type": "object",
                          "properties": {
                            "cpu": {
                              "type": "string"
                            },
                            "memory": {
                              "type": "string"
                            }
                          }
                        },
                        "requests": {
                          "type": "object",
                          "properties": {
                            "cpu": {
                              "type": "string"
                            },
                            "memory": {
                              "type": "string"
                            }
                          }
                        }
                      }
                    }
                  }
                },
                "istio-ingressgateway": {
                  "type": "object",
                  "properties": {
                    "resources": {
                      "type": "object",
                      "properties": {
                        "limits": {
                          "type": "object",
                          "properties": {
                            "cpu": {
                              "type": "string"
                            },
                            "memory": {
                              "type": "string"
                            }
                          }
                        },
                        "requests": {
                          "type": "object",
                          "properties": {
                            "cpu": {
                              "type": "string"
                            },
                            "memory": {
                              "type": "string"
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            },
            "global": {
              "type": "object",
              "properties": {
                "logging": {
                  "type": "object",
                  "properties": {
                    "level": {
                      "type": "string"
                    }
                  }
                },
                "mtls": {
                  "type": "object",
                  "properties": {
                    "enabled": {
                      "type": "boolean"
                    }
                  }
                },
                "proxy": {
                  "type": "object",
                  "properties": {
                    "resources": {
                      "type": "object",
                      "properties": {
                        "limits": {
                          "type": "object",
                          "properties": {
                            "cpu": {
                              "type": "string"
                            },
                            "memory": {
                              "type": "string"
                            }
                          }
                        },
                        "requests": {
                          "type": "object",
                          "properties": {
                            "cpu": {
                              "type": "string"
                            },
                            "memory": {
                              "type": "string"
                            }
                          }
                        }
                      }
                    }
                  }
                },
                "sds": {
                  "type": "object",
                  "properties": {
                    "enabled": {
                      "type": "boolean"
                    }
                  }
                }
              }
            },
            "mixer": {
              "type": "object",
              "properties": {
                "policy": {
                  "type": "object",
                  "properties": {
                    "enabled": {
                      "type": "boolean"
                    },
                    "resources": {
                      "type": "object",
                      "properties": {
                        "limits": {
                          "type": "object",
                          "properties": {
                            "cpu": {
                              "type": "string"
                            },
                            "memory": {
                              "type": "string"
                            }
                          }
                        },
                        "requests": {
                          "type": "object",
                          "properties": {
                            "cpu": {
                              "type": "string"
                            },
                            "memory": {
                              "type": "string"
                            }
                          }
                        }
                      }
                    }
                  }
                },
                "telemetry": {
                  "type": "object",
                  "properties": {
                    "enabled": {
                      "type": "boolean"
                    },
                    "resources": {
                      "type": "object",
                      "properties": {
                        "limits": {
                          "type": "object",
                          "properties": {
                            "cpu": {
                              "type": "string"
                            },
                            "memory": {
                              "type": "string"
                            }
                          }
                        },
                        "requests": {
                          "type": "object",
                          "properties": {
                            "cpu": {
                              "type": "string"
                            },
                            "memory": {
                              "type": "string"
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            },
            "pilot": {
              "type": "object",
              "properties": {
                "resources": {
                  "type": "object",
                  "properties": {
                    "limits": {
                      "type": "object",
                      "properties": {
                        "cpu": {
                          "type": "string"
                        },
                        "memory": {
                          "type": "string"
                        }
                      }
                    },
                    "requests": {
                      "type": "object",
                      "properties": {
                        "cpu": {
                          "type": "string"
                        },
                        "memory": {
                          "type": "string"
                        }
                      }
                    }
                  }
                },
                "traceSampling": {
                  "type": "number"
                }
              }
            }
          }
        },
        "keycloak": {
          "type": "object",
          "properties": {
            "enabled": {
              "type": "boolean"
            },
            "idp": {
              "type": "object",
              "properties": {
                "alias": {
                  "type": "string"
                }
              }
            },
            "realm": {
              "type": "string"
            }
          }
        },
        "loki": {
          "type": "object",
          "properties": {
            "adminPassword": {
              "type": "string"
            },
            "persistence": {
              "type": "object",
              "properties": {
                "size": {
                  "type": "string"
                }
              }
            },
            "retention": {
              "type": "object",
              "properties": {
                "duration": {
                  "type": "string"
                },
                "period": {
                  "type": "string"
                }
              }
            },
            "storageType": {
              "type": "string"
            }
          }
        },
        "nginx-ingress": {
          "type": "object",
          "properties": {
            "autoscaling": {
              "type": "object",
              "properties": {
                "enabled": {
                  "type": "boolean"
                }
              }
            }
          }
        },
        "oauth2-proxy": {
          "type": "object",
          "properties": {
            "config": {
              "type": "object",
              "properties": {
                "cookieSecret": {
                  "type": "string"
                }
              }
            }
          }
        },
        "otomi-api": {
          "type": "object",
          "properties": {
            "git": {
              "type": "object",
              "properties": {
                "branch": {
                  "type": "string"
                },
                "email": {
                  "type": "string"
                },
                "localPath": {
                  "type": "string"
                },
                "password": {
                  "type": "string"
                },
                "repoUrl": {
                  "type": "string"
                },
                "user": {
                  "type": "string"
                }
              }
            },
            "image": {
              "type": "object",
              "properties": {
                "pullPolicy": {
                  "type": "string"
                },
                "tag": {
                  "type": "string"
                }
              }
            },
            "tools": {
              "type": "object",
              "properties": {
                "gcloudServiceKey": {
                  "type": "string"
                },
                "image": {
                  "type": "object",
                  "properties": {
                    "tag": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          }
        },
        "otomi-web": {
          "type": "object",
          "properties": {
            "image": {
              "type": "object",
              "properties": {
                "pullPolicy": {
                  "type": "string"
                },
                "tag": {
                  "type": "string"
                }
              }
            }
          }
        },
        "prometheus-operator": {
          "type": "object",
          "properties": {
            "alertmanager": {
              "type": "object",
              "properties": {
                "groupInterval": {
                  "type": "string"
                },
                "receiver": {
                  "type": "string"
                },
                "repeatInterval": {
                  "type": "string"
                },
                "slack": {
                  "type": "object",
                  "properties": {
                    "channel": {
                      "type": "string"
                    },
                    "url": {
                      "type": "string"
                    }
                  }
                }
              }
            },
            "grafana": {
              "type": "object",
              "properties": {
                "adminPassword": {
                  "type": "string"
                }
              }
            },
            "prometheus": {
              "type": "object",
              "properties": {
                "storageSize": {
                  "type": "string"
                }
              }
            }
          }
        },
        "redis-shared": {
          "type": "object",
          "properties": {
            "enabled": {
              "type": "boolean"
            }
          }
        },
        "sitespeed": {
          "type": "object",
          "properties": {
            "enabled": {
              "type": "boolean"
            },
            "pvc": {
              "type": "object",
              "properties": {
                "graphite": {
                  "type": "string"
                },
                "results": {
                  "type": "string"
                }
              }
            },
            "retention": {
              "type": "string"
            },
            "schedule": {
              "type": "string"
            }
          }
        }
      }
    },
    "clouds": {
      "type": "object",
      "patternProperties": {
        "^.*$": { "$ref": "#/definitions/cloud" }
      },
      "additionalProperties": false
    },
    "customer": {
      "type": "object",
      "properties": {
        "name": {
          "type": "string"
        }
      }
    },
    "otomi": {
      "type": "object",
      "properties": {
        "isManaged": {
          "type": "boolean"
        },
        "isMultitenant": {
          "type": "boolean"
        },
        "isRedkubesMonitored": {
          "type": "boolean"
        },
        "pullSecret": {
          "type": "string"
        },
        "teamPrefix": {
          "type": "string"
        }
      }
    },
    "oidc": {
      "type": "object",
      "properties": {
        "clientID": {
          "type": "string"
        },
        "clientSecret": {
          "type": "string"
        },
        "idp": {
          "type": "object",
          "properties": {
            "adminGroupID": {
              "type": "string"
            },
            "clientID": {
              "type": "string"
            },
            "clientSecret": {
              "type": "string"
            },
            "issuer": {
              "type": "string"
            },
            "teamAdminGroupID": {
              "type": "string"
            },
            "tenantID": {
              "type": "string"
            }
          }
        },
        "scope": {
          "type": "string"
        }
      }
    },
    "teamConfig": {
      "type": "object",
      "properties": {
        "teams": {
          "type": "object",
          "patternProperties": {
            "^[a-z-]+$": { "$ref": "#/definitions/team" }
          },
          "additionalProperties": false
        }
      }
    }
  }
}
