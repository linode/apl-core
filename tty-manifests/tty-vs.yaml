apiVersion: networking.istio.io/v1beta1
kind: VirtualService
metadata:
  name: tty-${SUB}
  namespace: team-admin
spec:
  gateways:
    - team-admin/team-admin-public-tlsterm
  hosts:
    - tty.${FQDN}
  http:
    - match:
        - uri:
            prefix: /logout-otomi
      redirect:
        authority: auth.${FQDN}
        uri: /oauth2/sign_out?rd=https://keycloak.${FQDN}/realms/otomi/protocol/openid-connect/logout?redirect_uri=https://otomi.${FQDN}
    - match:
        - uri:
            prefix: /${SUB}
      rewrite:
        uri: /
      route:
        - destination:
            host: tty-${SUB}.team-admin.svc.cluster.local
            port:
              number: 8080
          headers:
            request:
              set:
                X-Forwarded-Proto: https
---

