$schema: 'http://json-schema.org/draft-07/schema'
additionalProperties: false
definitions:
  alerts:
    properties:
      drone:
        default: slack
        enum:
          - slack
          - msteams
        type: string
      email:
        additionalProperties: false
        properties:
          critical:
            $ref: '#/definitions/email'
            description: One or more email addresses (comma separated) for critical events.
          nonCritical:
            $ref: '#/definitions/email'
            description: One or more email addresses (comma separated) for non-critical events.
      groupInterval:
        default: 5m
        description: How long to wait before sending a notification about new alerts that are added to a group of alerts for which an initial notification has already been sent. (Usually ~5m or more.)
        type: string
      msteams:
        additionalProperties: false
        properties:
          highPrio:
            description: The low prio web hook.
            type: string
          lowPrio:
            description: The high prio web hook.
            type: string
      receivers:
        description: Notification receivers.
        items:
          enum:
            - slack
            - msteams
            - email
          type: string
        type: array
      repeatInterval:
        default: 3h
        description: How long to wait before sending a notification again if it has already been sent successfully for an alert. (Usually ~3h or more).
        type: string
      slack:
        additionalProperties: false
        properties:
          channel:
            default: mon-otomi
            description: The Slack channel for non-critical notifications.
            type: string
          channelCrit:
            default: mon-otomi
            description: The Slack channel for critical notifications.
            type: string
          url:
            $ref: '#/definitions/url'
            description: A Slack webhook URL.
  annotations:
    $ref: '#/definitions/labelsAnnotations'
    description: A set of annotations.
  azureMonitor:
    properties:
      appInsightsApiKey:
        description: An Azure AppInsights client secret (defaults to clientSecret).
        type: string
      appInsightsAppId:
        description: An Azure AppInsights client id (defaults to clientId).
        type: string
      clientId:
        description: An Azure client id.
        type: string
      clientSecret:
        description: An Azure client secret.
        type: string
      logAnalyticsClientId:
        description: An Azure client secret (defaults to clientSecret).
        type: string
      logAnalyticsClientSecret:
        description: An Azure client secret (defaults to clientSecret).
        type: string
      logAnalyticsTenantId:
        description: An Azure tenant id (defaults to tenantId).
        type: string
      logAnalyticsWorkspace:
        description: An Azure monitor log analytics workspace.
        type: string
  cloud:
    description: A common cloud configuration.
    properties:
      clusters:
        additionalProperties: false
        patternProperties:
          '^[a-z-]+$':
            $ref: '#/definitions/cluster'
      domain:
        $ref: '#/definitions/domain'
    required:
      - domain
      - clusters
  cluster:
    additionalProperties: false
    properties:
      apiName:
        description: Only used for API/UI to show in app.
        type: string
      apiServer:
        description: Used by kubectl for local deployment to target cluster.
        type: string
      dnsProvider:
        description: Only set it if you want DNS provider to be different than cloud provider of this cluster.
        enum:
          - azure
          - google
          - aws
        type: string
      dnsZones:
        description: Extra dns zones that the cluster can administer (see dns). Team services can use this to publish their URLs on.
        items:
          $ref: '#/definitions/domain'
        type: array
      domain:
        $ref: '#/definitions/domain'
        description: Base cloud domain for the cluster domain. Also added to list of dns zones in the Otomi Console.
      enabled:
        default: true
        type: boolean
      entrypoint:
        description: A Kubernetes API public IP address (onprem only).
        type: string
      k8sVersion:
        $ref: '#/definitions/k8sVersion'
      otomiVersion:
        default: latest
        description: 'Please pin this a valid release version found in the repo. Suggestion: try the most recent stable version.'
        type: string
      region:
        description: Dependent on provider.
        examples:
          - europe-west4
          - eu-central-1
          - westeurope
        type: string
      vpcID:
        description: AWS only. If provided will override autodiscovery from metadata.
        type: string
    required:
      - apiServer
      - k8sVersion
      - otomiVersion
      - region
  cpuQuantity:
    description: 'Amount of cores, or slice of cpu in millis.'
    examples:
      - '1'
      - 200m
    pattern: '^([0-9]+\.[0-9]{1,2})|([0-9]{2,3}m)?$'
    type: string
  domain:
    pattern: '^(([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9\-]*[a-zA-Z0-9])\.)*([A-Za-z0-9]|[A-Za-z0-9][A-Za-z0-9\-]*[A-Za-z0-9])$'
    type: string
  droneGit:
    properties:
      clientID:
        type: string
      clientSecretValue:
        type: string
  email:
    pattern: '^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$'
    type: string
  env:
    additionalProperties: false
    patternProperties:
      '[a-zA-Z_]{1,}[a-zA-Z0-9_]*':
        maxLength: 131072
        type: string
    nullable: true
    title: Environment variables
  hostPort:
    pattern: '^(([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9\-]*[a-zA-Z0-9])\.)*([A-Za-z0-9]|[A-Za-z0-9][A-Za-z0-9\-]*[A-Za-z0-9]):()([1-9]|[1-5]?[0-9]{2,4}|6[1-4][0-9]{3}|65[1-4][0-9]{2}|655[1-2][0-9]|6553[1-5])$'
    type: string
  idName:
    description: A lowercase name that starts with a letter and may contain dashes.
    pattern: '^[a-z0-9]([-a-z0-9]*[a-z0-9])?$'
    type: string
  image:
    additionalProperties: false
    properties:
      pullPolicy:
        default: IfNotPresent
        enum:
          - IfNotPresent
          - Always
        type: string
      repository:
        $ref: '#/definitions/repository'
      tag:
        default: latest
        type: string
    title: Container image
  imageSimple:
    additionalProperties: false
    properties:
      pullPolicy:
        default: IfNotPresent
        enum:
          - IfNotPresent
          - Always
        type: string
      tag:
        type: string
    title: Container image
  jobs:
    description: You may pass an array of Job objects. The Kubernetes API accepts
      a Job specification, which is meant for run-to-completion apps (e.g. batch
      Jobs).
    additionalProperties: false
    items:
      additionalProperties: false
      properties:
        enabled:
          default: true
          type: boolean
        env:
          default:
            foo: bar
          $ref: '#/definitions/env'
        files:
          default:
            foo: bar.log
          description: May mount files directly into the container.
            The mount path is /, so a user can specify anything that comes after it.
            E.g.
            foo/bar.log -> /foo/bar.log
            foo.log -> /foo.log
          patternProperties:
            '^(.*/)|[a-z-]+([^/]*)$':
              type: string
        image:
          $ref: '#/definitions/image'
        init:
          properties:
            env:
              $ref: '#/definitions/env'
            image:
              $ref: '#/definitions/image'
            script:
              $ref: '#/definitions/script'
            secrets:
              $ref: '#/definitions/secrets'
        name:
          default: foo
          description: Must be a unique name.
          pattern: '^[a-z0-9]([-a-z0-9]*[a-z0-9])?$'
          type: string
        resources:
          $ref: '#/definitions/resources'
        runPolicy:
          default: OnSpecChange
          description: |
            If runPolicy is set to 'Always', the job controller will always be re-deployed after a successful deployment with Helm.
            If runPolicy is set to 'OnSpecChange', the job controller will only be re-deployed if one changes this specification.
          enum:
            - Always
            - OnSpecChange
          type: string
        schedule:
          default: 0 1 * * *
          description: Must give a cron-type expression if the job-type is 'cronjob' (job.type).
          type: string
        secrets:
          $ref: '#/definitions/secrets'
        script:
          $ref: '#/definitions/script'
        ttlSecondsAfterFinished:
          default: 86400
          type: number
        type:
          default: Job
          enum:
            - Job
            - CronJob
          type: string
    required:
      - image
      - name
      - script
      - type
    type: array
  k8sVersion:
    default: '1.18'
    description: The cluster k8s version. Otomi supports 2 minor versions backwards compatibility from the suggested default.
    enum:
      - '1.17'
      - '1.18'
      - '1.19'
    type: string
  labels:
    $ref: '#/definitions/labelsAnnotations'
    description: A set of labels.
  labelsAnnotations:
    additionalProperties: false
    patternProperties:
      ? '^((([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9\-]*[a-zA-Z0-9])\.)*([A-Za-z0-9]|[A-Za-z0-9][A-Za-z0-9\-]*[A-Za-z0-9]){1,253}\/)?([a-z0-9A-Z]+[a-z0-9A-Z-_.]+[a-z0-9A-Z]){1,63}$'
      : pattern: '^((.){1,253}\/)?(.){1,63}$'
        type: string
  logLevel:
    type: string
    default: info
    enum:
      - error
      - warn
      - info
      - debug
      - trace
  memoryQuantity:
    description: Amount of memory. Valid units are E|P|T|G|M|K|Ei|Pi|Ti|Gi|Mi|Ki.
    examples:
      - 1Mi
      - 0.5M
    pattern: '^([0-9]+\.)?[0-9]+(E|P|T|G|M|K|Ei|Pi|Ti|Gi|Mi|Ki)?$'
    type: string
  portNumber:
    maximum: 32768
    minimum: 80
    type: number
  registry:
    pattern: '^[a-z0-9]+(?:[._-][a-z0-9]+)*$'
    type: string
  repoUrl:
    description: Path to a remote git repo without protocol. Will use https to access.
    pattern: '^(.+@)*([\w\d\.]+)(:[\d]+){0,1}/*(.*)$'
    type: string
  repository:
    description: A container image repository.
    pattern: '^[a-z0-9]+(?:[/._-]{1,2}[a-z0-9]+)*$'
    type: string
  resource:
    additionalProperties: false
    properties:
      cpu:
        $ref: '#/definitions/cpuQuantity'
      memory:
        $ref: '#/definitions/memoryQuantity'
    required:
      - cpu
      - memory
  resources:
    additionalProperties: false
    description: Compute resources for containers.
    properties:
      limits:
        $ref: '#/definitions/resource'
        description: Requested resources (best effort).
      requests:
        $ref: '#/definitions/resource'
        description: Requested resources (guaranteed).
    title: Pod resources
  scaling:
    description: Min and max number of replicas.
    properties:
      maxReplicas:
        type: number
      minReplicas:
        type: number
  subdomainType:
    type: string
    pattern: '^[a-z0-9]([-a-z0-9]*[a-z0-9])?(\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*$'
  externalSecret:
    type: object
    properties:
      id:
        readOnly: true
        type: string
      name:
        $ref: '#/definitions/subdomainType'
    required:
      - name
    oneOf:
      - title: Generic
        properties:
          type:
            default: generic
            enum:
              - generic
          secretPath:
            $ref: '#/definitions/vaultPath'
          entries:
            type: array
            items:
              properties:
                name:
                  $ref: '#/definitions/vaultProperty'
                value:
                  $ref: '#/definitions/vaultPath'
              required:
                - name
                - value
              minItems: 1
              uniqueItems: true
        required:
          - type
          - entries
      - title: Docker registry
        properties:
          type:
            default: docker-registry
            enum:
              - docker-registry
            type: string
          secretPath:
            $ref: '#/definitions/vaultPath'
          itemName:
            type: string
            default: '.dockerconfig.json'
            readOnly: true
        required:
          - type
          - secretPath
      - title: TLS
        properties:
          type:
            default: tls
            enum:
              - tls
            type: string
          caSecretPath:
            $ref: '#/definitions/vaultPath'
          caItemName:
            type: string
            default: 'ca.pem'
          crtSecretPath:
            $ref: '#/definitions/vaultPath'
          crtItemName:
            type: string
            default: 'crt.pem'
          keySecretPath:
            $ref: '#/definitions/vaultPath'
          keyItemName:
            type: string
            default: 'key.pem'
        required:
          - type
          - caSecretPath
          - crtSecretPath
          - keySecretPath
  script:
    description: May specify a non-empty string containing an executable script.
    type: string
  secret:
    oneOf:
      - properties:
          password:
            type: string
          server:
            $ref: '#/definitions/registry'
          type:
            default: docker-registry
            enum:
              - docker-registry
            type: string
          username:
            type: string
        required:
          - server
          - username
          - password
        title: Docker Registry
      - properties:
          entries:
            description: Key names and their values.
            items:
              properties:
                key:
                  description: Key or file name.
                  example: secretstuff.conf
                  type: string
                value:
                  description: Value to be encrypted.
                  example: password=yoursecretpassword
                  type: string
              required:
                - key
                - value
            type: array
          type:
            default: generic
            enum:
              - generic
            type: string
        required:
          - entries
        title: Generic
      - properties:
          ca:
            description: The CA certificate content.
            type: string
          crt:
            description: The PEM encoded public key certificate content.
            type: string
          key:
            description: The private key certificate content.
            type: string
          type:
            default: tls
            enum:
              - tls
            type: string
        required:
          - crt
          - key
        title: TLS
    properties:
      id:
        readOnly: true
        type: string
      name:
        $ref: '#/definitions/idName'
    required:
      - name
      - type
  secrets:
    items:
      additionalProperties: true
      properties:
        entries:
          items:
            properties:
              key:
                type: string
              value:
                type: string
          title: Entries
          type: array
          uniqueItems: true
        name:
          type: string
      required:
        - name
    nullable: true
    title: Secrets
    type: array
  team:
    additionalProperties: false
    properties:
      alerts:
        $ref: '#/definitions/alerts'
      azureMonitor:
        $ref: '#/definitions/azureMonitor'
      clusters:
        items:
          type: string
        type: array
      id:
        $ref: '#/definitions/idName'
        description: Must be the same as the name.
      jobs:
        $ref: '#/definitions/jobs'
      oidc:
        additionalProperties: false
        properties:
          groupMapping:
            description: IDP group id to map onto this team.
            type: string
      password:
        description: Will be used to separate team resources.
        type: string
      secrets:
        $ref: '#/definitions/secrets'
      externalSecrets:
        items:
          $ref: '#/definitions/externalSecret'
        type: array
      services:
        items:
          additionalProperties: false
          properties:
            authz:
              additionalProperties: false
              description: Identifies a workload to authorize.
              properties:
                forwardOriginalToken:
                  default: false
                  description: If true istio will forward the bearer token instead of removing it from the headers.
                  type: boolean
                workload:
                  $ref: '#/definitions/labelsAnnotations'
            domain:
              description: A custom service domain name.
              type: string
            forwardPath:
              default: false
              description: "Whether to forward the path into the service, or 'terminate' it."
              type: boolean
            id:
              description: Unique identifier created by and used in API. Optional.
              type: string
            internal:
              default: false
              description: 'If true, service is not going to be exposed to the public domain.'
              type: boolean
            isPublic:
              default: false
              description: If true then no SSO will be used.
              type: boolean
            isShared:
              description: When true the service will get it's own domain by prefixing the app name to the cluster domain. Mostly used by core apps.
              type: boolean
            ksvc:
              additionalProperties: false
              description: Details for a knative service that will be deployed and operated.
              properties:
                annotations:
                  $ref: '#/definitions/annotations'
                autoCD:
                  additionalProperties: false
                  description: NOT IN USE YET! Deploys new images based on a tagging strategy.
                  oneOf:
                    - additionalProperties: false
                      nullable: true
                      title: 'Off'
                    - nullable: true
                      properties:
                        additionalProperties: false
                        semver:
                          description: 'Use this filter if your images tags follow semantic versioning rules (MAJOR.MINOR.PATCH). E.g.: PATCH only: "~1.1", MINOR and PATCH only "~1", ALL "*".'
                          example: 'PATCH only: "~1.1", MINOR and PATCH only "~1", ALL "*",  ">=1.2.3-0"'
                          title: Semver version pattern
                          type: string
                        tagMatcher:
                          default: semver
                          enum:
                            - semver
                          type: string
                      required:
                        - semver
                      title: Semver versioning
                    - additionalProperties: false
                      properties:
                        glob:
                          description: 'Use this filter if you want to make simple non-standard patterns. E.g.: "master-v1.*.*".'
                          example: master-v1.*.*
                          title: Glob string pattern
                          type: string
                        tagMatcher:
                          default: glob
                          enum:
                            - glob
                          type: string
                      required:
                        - glob
                      title: Glob pattern matching
                  title: Continuous delivery pipeline
                env:
                  $ref: '#/definitions/env'
                image:
                  $ref: '#/definitions/image'
                predeployed:
                  default: false
                  description: Has this service been predeployed? Otherwise otomi will start it with the configuration given.
                  type: boolean
                resources:
                  $ref: '#/definitions/resources'
                scaleToZero:
                  default: false
                  description: Scales to zero after 60 seconds and needs approximately 8 seconds to start back up.
                  title: Scale to zero
                  type: boolean
                secrets:
                  $ref: '#/definitions/secrets'
            name:
              $ref: '#/definitions/idName'
              description: 'Short name. Will be used for generation of knative service name, as well as service URL.'
            ownHost:
              default: true
              description: When true the service will get it's own domain by prefixing the app name to the team domain. Mostly set to true. This will probably be removed soon.
              type: boolean
            paths:
              items:
                description: |
                  Path mapping to only let this path go to the service. This allows micro services to operate on the same domain and port.
                  When left empty all paths will go to this service.
                type: string
              type: array
            port:
              $ref: '#/definitions/portNumber'
              default: 80
              description: Points to the backing k8s service (only used when 'svc' is set).
            svc:
              $ref: '#/definitions/idName'
              description: 'When given a backing k8s service is expected to be deployed with this name, which will be exposed through this team service.'
          required:
            - id
            - name
        type: array
    required:
      - id
  url:
    pattern: '^(https:\/\/)([\w\-])+\.{1}([a-zA-Z]{2,63})([\/\w-]*)*\/?\??([^#\n\r]*)?#?([^\n\r]*)$'
    type: string
  vaultPath:
    description: A path to a secret at Vault KV engine
    pattern: '^\/([A-z0-9-_+]+\/)*([A-z0-9-_]+)$'
    type: string
  vaultProperty:
    description: A property name at vaultPath
    pattern: '^[a-zA-Z0-9_]*$'
    type: string
  vaultDefaultSeal:
    properties:
      type:
        type: string
        default: default
        enum:
          - default
  vaultAwsStorage:
    properties:
      region:
        type: string
      bucket:
        type: string
    required:
      - region
      - bucket
  vaultAwsSeal:
    properties:
      type:
        type: string
        default: awskms
        enum:
          - awskms
      region:
        type: string
      access_key:
        type: string
      secret_key:
        type: string
      kms_key_id:
        type: string
      endpoint:
        type: string
    required:
      - type
      - region
      - access_key
      - secret_key
      - kms_key_id
      - endpoint
  vaultAzureStorage:
    properties:
      accountName:
        type: string
      accountKey:
        type: string
      container:
        type: string
      environment:
        type: string
  vaultAzureSeal:
    properties:
      type:
        type: string
        default: azurekeyvault
        enum:
          - azurekeyvault
      vault_name:
        type: string
      key_name:
        type: string
      tenant_id:
        type: string
      client_id:
        type: string
      client_secret:
        type: string
    required:
      - type
      - vault_name
      - key_name
      - tenant_id
      - client_id
      - client_secret

  vaultGoogleStorage:
    properties:
      bucket:
        type: string
    required:
      - bucket
  vaultGoogleSeal:
    properties:
      type:
        type: string
        default: gcpckms
        enum:
          - gcpckms
      project:
        type: string
      region:
        type: string
      key_ring:
        type: string
      crypto_key:
        type: string
      encodedCloudToken:
        type: string
    required:
      - type
      - project
      - region
      - key_ring
      - crypto_key
      - encodedCloudToken

  volumes:
    items:
      additionalProperties: false
      properties:
        name:
          description: Name must match mount name.
          type: string
        configMap:
          properties:
            name:
              type: string
    type: array
properties:
  alerts:
    $ref: '#/definitions/alerts'
  azure:
    description: Azure specific configuration.
    properties:
      appgw:
        properties:
          isManaged:
            default: true
            description: Is this appgw installed as AKS addon?
            type: boolean
      diskType:
        description: An Azure disk type (SKU Type).
        enum:
          - Standard_LRS
          - Standard_GRS
          - Standard_RAGRS
          - Standard_ZRS
          - Premium_LRS
          - Premium_ZRS
          - Standard_GZRS
          - Standard_RAGZRS
        type: string
      keyVault:
        description: Azure Key Vault access credentials. Will use azure.tenantId if tenantId is not provided.
        properties:
          tenantId:
            description: An Azure tenant ID.
            type: string
          clientId:
            description: An Azure client ID.
            type: string
          clientSecret:
            description: An Azure client secret.
            type: string
        required:
          - clientId
          - clientSecret
      monitor:
        $ref: '#/definitions/azureMonitor'
      resourceGroup:
        description: An Azure resource group.
        type: string
      subscriptionId:
        description: An Azure subscription ID.
        type: string
      tenantId:
        description: An Azure tenant ID.
        type: string
    required:
      - diskType
      - resourceGroup
      - subscriptionId
      - tenantId
  charts:
    additionalProperties: false
    properties:
      cert-manager:
        additionalProperties: false
        properties:
          azureClientSecret:
            type: string
          email:
            $ref: '#/definitions/email'
          provider:
            additionalProperties: false
            properties:
              aws:
                additionalProperties: false
                properties:
                  route53:
                    additionalProperties: false
                    properties:
                      region:
                        type: string
              azure:
                additionalProperties: false
                properties:
                  azuredns:
                    additionalProperties: false
                    properties:
                      clientID:
                        type: string
                      hostedZoneName:
                        type: string
                      resourceGroupName:
                        type: string
                      subscriptionID:
                        type: string
                      tenantID:
                        type: string
                    required:
                      - clientID
                      - tenantID
                      - subscriptionID
                      - resourceGroupName
                      - hostedZoneName
              google:
                additionalProperties: false
                properties:
                  clouddns:
                    additionalProperties: false
                    properties:
                      project:
                        type: string
                      serviceAccountSecretRef:
                        additionalProperties: false
                        properties:
                          key:
                            type: string
                          name:
                            type: string
          stage:
            description: |
              The Letâ€™s Encrypt environment that is used for issuing certificates.
              The 'production' environment issues trusted certificates but has narrow rate limits, whereas the 'staging' environment issues untrusted certificates but provides broader rate limits.
              Read more about rate limits: https://letsencrypt.org/docs/rate-limits/.
            enum:
              - staging
              - production
            type: string
      cluster-overprovisioner:
        additionalProperties: false
        properties:
          cpu:
            $ref: '#/definitions/cpuQuantity'
          enabled:
            type: boolean
          memory:
            $ref: '#/definitions/memoryQuantity'
      drone:
        additionalProperties: false
        properties:
          adminUser:
            type: string
          adminToken:
            type: string
          debug:
            default: false
            type: boolean
          enabled:
            default: false
            type: boolean
          githubAdmins:
            additionalProperties: false
            properties:
              org:
                type: string
              team:
                type: string
              token:
                type: string
          orgsFilter:
            type: string
          owner:
            $ref: '#/definitions/idName'
          repo:
            $ref: '#/definitions/idName'
          repoFilter:
            type: string
          resources:
            additionalProperties: false
            properties:
              runner:
                $ref: '#/definitions/resources'
              server:
                $ref: '#/definitions/resources'
          sharedSecret:
            description: A secret used by drone-admit-members plugin.
            type: string
          sourceControl:
            additionalProperties: false
            properties:
              bitbucketCloud:
                $ref: '#/definitions/droneGit'
              bitbucketServer:
                properties:
                  consumerKey:
                    default: consumerKey
                    type: string
                  passwordKey:
                    default: password
                    type: string
                  privateKey:
                    default: privateKey
                    type: string
                  server:
                    type: string
                  username:
                    type: string
              gitea:
                allOf:
                  - $ref: '#/definitions/droneGit'
                  - properties:
                      server:
                        type: string
              github:
                allOf:
                  - $ref: '#/definitions/droneGit'
                  - properties:
                      server:
                        default: 'https://github.com'
                        type: string
              gitlab:
                allOf:
                  - $ref: '#/definitions/droneGit'
                  - properties:
                      server:
                        type: string
              gogs:
                properties:
                  server:
                    type: string
              provider:
                default: github
                enum:
                  - github
                  - gitlab
                  - gitea
                  - gogs
                  - bitbucketCloud
                  - bitbucketServer
                type: string
      external-dns:
        additionalProperties: false
        properties:
          aws:
            properties:
              region:
                type: string
            required:
              - region
          azure:
            properties:
              cloud:
                type: string
                description: Azure Cloud to use
              resourceGroup:
                type: string
                description: Azure resource group to use
              tenantId:
                type: string
                description: Azure tenant ID to use (will default to global value)
              subscriptionId:
                type: string
                description: Azure subscription ID to use (will default to global value)
              aadClientId:
                type: string
                description: Azure Application Client ID to use
              aadClientSecret:
                type: string
                description: Azure Application Client Secret to use
              useManagedIdentityExtension:
                type: boolean
                description: If you use Azure MSI, this should be set to true
                default: false
          domainFilters:
            items:
              type: string
            type: array
          zoneIdFilters:
            items:
              type: string
      gatekeeper-operator:
        additionalProperties: false
        properties:
          enabled:
            type: boolean
          excludedNamespaces:
            type: array
            items:
              type: string
          emitAuditEvents:
            type: boolean
          emitAdmissionEvents:
            type: boolean
          auditFromCache:
            type: boolean
          disableValidatingWebhook:
            type: boolean
          logLevel:
            type: string
          constraintViolationsLimit:
            type: number
          auditInterval:
            type: number
          replicas:
            type: number
          dataSync:
            type: array
            items:
              type: object
      harbor:
        additionalProperties: false
        properties:
          adminPassword:
            type: string
          enabled:
            type: boolean
          persistence:
            additionalProperties: false
            properties:
              imageChartStorage:
                additionalProperties: false
                properties:
                  gcs:
                    additionalProperties: false
                    properties:
                      bucket:
                        type: string
                      encodedkey:
                        type: string
                      rootdirectory:
                        type: string
                  type:
                    type: string
          resources:
            additionalProperties: false
            properties:
              adapter:
                $ref: '#/definitions/resources'
              chartmuseum:
                $ref: '#/definitions/resources'
              clair:
                $ref: '#/definitions/resources'
              controller:
                $ref: '#/definitions/resources'
              core:
                $ref: '#/definitions/resources'
              database:
                $ref: '#/definitions/resources'
              jobservice:
                $ref: '#/definitions/resources'
              portal:
                $ref: '#/definitions/resources'
          secretKey:
            type: string
      hello:
        properties:
          enabled:
            description: Hello world demo chart. When you turn this off you may also have to remove the ingress service.
            type: boolean
            default: false
      httpbin:
        properties:
          enabled:
            description: The famous httpbin application.
            type: boolean
            default: false
      ingress-azure:
        additionalProperties: false
        description: A chart for Azure Application Gateway.
        properties:
          appgw:
            additionalProperties: false
            description: Application Gateway.
            properties:
              name:
                description: A name of the Application Gateway.
                type: string
              resourceGroup:
                description: A name of the Azure Resource Group in which Application Gateway was created.
                type: string
              subnetName:
                description: A subnet of the application gateway.
                type: string
              subnetPrefix:
                description: A subnet in CIDR notation.
                examples:
                  - 10.1.0.0/16
                type: string
              subscriptionId:
                description: The Azure Subscription ID in which Application Gateway resides.
                type: string
              usePrivateIP:
                default: false
                description: Whether to use a private ip range or not.
                type: boolean
            required:
              - subscriptionId
              - resourceGroup
              - name
              - subnetName
              - subnetPrefix
          armAuth:
            additionalProperties: false
            description: A service Principal secret.
            properties:
              secretJSON:
                description: A service Principal secret JSON key (base64 encoded).
                type: string
            required:
              - secretJSON
        required:
          - armAuth
          - appgw
      istio:
        additionalProperties: false
        properties:
          addonComponents:
            additionalProperties: false
            properties:
              grafana:
                additionalProperties: false
                properties:
                  enabled:
                    type: boolean
              kiali:
                additionalProperties: false
                properties:
                  enabled:
                    type: boolean
              prometheus:
                additionalProperties: false
                properties:
                  enabled:
                    type: boolean
              tracing:
                additionalProperties: false
                properties:
                  enabled:
                    type: boolean
          autoscaling:
            properties:
              egressgateway:
                $ref: '#/definitions/scaling'
              gateway-local:
                $ref: '#/definitions/scaling'
              ingressgateway:
                $ref: '#/definitions/scaling'
              ingressgateway-auth:
                $ref: '#/definitions/scaling'
              pilot:
                $ref: '#/definitions/scaling'
          egressGateway:
            properties:
              enabled:
                default: false
                type: boolean
          global:
            additionalProperties: false
            properties:
              logging:
                properties:
                  level:
                    type: string
              mtls:
                additionalProperties: false
                properties:
                  enabled:
                    type: boolean
              proxy:
                additionalProperties: false
                properties:
                  resources:
                    $ref: '#/definitions/resources'
              sds:
                additionalProperties: false
                properties:
                  enabled:
                    type: boolean
          meshConfig:
            properties:
              defaultConfig:
                type: object
            required:
              - defaultConfig
          resources:
            properties:
              egressgateway:
                $ref: '#/definitions/resources'
              gateway-local:
                $ref: '#/definitions/resources'
              ingressgateway:
                $ref: '#/definitions/resources'
              ingressgateway-auth:
                $ref: '#/definitions/resources'
              pilot:
                $ref: '#/definitions/resources'
      jobs:
        $ref: '#/definitions/jobs'
      keycloak:
        additionalProperties: false
        properties:
          enabled:
            type: boolean
          idp:
            additionalProperties: false
            properties:
              alias:
                type: string
              clientID:
                type: string
              clientSecret:
                type: string
          realm:
            type: string
          resources:
            additionalProperties: false
            properties:
              keycloak:
                $ref: '#/definitions/resources'
              postgresql:
                $ref: '#/definitions/resources'
          theme:
            enum:
              - default
              - otomi
            type: string
      kubeapps:
        additionalProperties: false
        properties:
          enabled:
            default: true
            type: boolean
      kubernetes-external-secrets:
        additionalProperties: false
        properties:
          logLevel:
            $ref: '#/definitions/logLevel'
      kube-descheduler:
        additionalProperties: false
        properties:
          enabled:
            default: true
            type: boolean
          schedule:
            default: '*/30 * * * *'
            type: string
      loki:
        additionalProperties: false
        properties:
          adminPassword:
            type: string
          persistence:
            additionalProperties: false
            properties:
              size:
                type: string
          retention:
            additionalProperties: false
            properties:
              duration:
                type: string
              period:
                type: string
          storageType:
            type: string
      nginx-ingress:
        additionalProperties: false
        properties:
          autoscaling:
            additionalProperties: false
            properties:
              enabled:
                default: true
                type: boolean
          resources:
            $ref: '#/definitions/resources'
      oauth2-proxy:
        additionalProperties: false
        properties:
          config:
            properties:
              cookieSecret:
                description: Cookie secret must be 128 bit base64 encoded string.
                pattern: '^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$'
                type: string
      oauth2-proxy-redis:
        additionalProperties: false
        properties:
          resources:
            additionalProperties: false
            properties:
              master:
                $ref: '#/definitions/resources'
              sentinel:
                $ref: '#/definitions/resources'
              slave:
                $ref: '#/definitions/resources'
      otomi-api:
        additionalProperties: false
        properties:
          git:
            additionalProperties: false
            properties:
              branch:
                type: string
              email:
                $ref: '#/definitions/email'
              localPath:
                type: string
              password:
                type: string
              repoUrl:
                $ref: '#/definitions/repoUrl'
              user:
                type: string
          image:
            $ref: '#/definitions/imageSimple'
          resources:
            additionalProperties: false
            properties:
              api:
                $ref: '#/definitions/resources'
              tools:
                $ref: '#/definitions/resources'
          tools:
            additionalProperties: false
            properties:
              azureTenantId:
                type: string
              azureClientId:
                type: string
              azureClientSecret:
                type: string
              gcloudServiceKey:
                type: string
              image:
                $ref: '#/definitions/imageSimple'
      otomi-console:
        additionalProperties: false
        properties:
          image:
            $ref: '#/definitions/imageSimple'

      prometheus-operator:
        properties:
          additionalProperties: false
          grafana:
            additionalProperties: false
            properties:
              adminPassword:
                type: string
          prometheus:
            additionalProperties: false
            properties:
              storageSize:
                type: string
          resources:
            additionalProperties: false
            properties:
              grafana:
                $ref: '#/definitions/resources'
              prometheus:
                $ref: '#/definitions/resources'
      redis-shared:
        additionalProperties: false
        properties:
          enabled:
            type: boolean
          resources:
            additionalProperties: false
            properties:
              master:
                $ref: '#/definitions/resources'
              sentinel:
                $ref: '#/definitions/resources'
              slave:
                $ref: '#/definitions/resources'
      sitespeed:
        additionalProperties: false
        properties:
          enabled:
            type: boolean
          pvc:
            additionalProperties: false
            properties:
              graphite:
                type: string
              results:
                type: string
          retention:
            type: string
          schedule:
            type: string
      vault:
        type: object
        additionalProperties: false
        properties:
          enabled:
            type: boolean
            default: true
          seal:
            description: Use Cloud KMS to encrypt and decrypt the master key
            oneOf:
              - title: default
                $ref: '#/definitions/vaultDefaultSeal'
              - title: gcpckms
                $ref: '#/definitions/vaultGoogleSeal'
              - title: awskms
                $ref: '#/definitions/vaultAwsSeal'
              - title: azurekeyvault
                $ref: '#/definitions/vaultAzureSeal'
          logLevel:
            $ref: '#/definitions/logLevel'

      weave-scope:
        default: false
        enabled: boolean
  clouds:
    additionalProperties: false
    properties:
      aws:
        $ref: '#/definitions/cloud'
      azure:
        $ref: '#/definitions/cloud'
      google:
        $ref: '#/definitions/cloud'
      onprem:
        $ref: '#/definitions/cloud'
  cluster:
    description: An internal otomi object (do not edit it).
  customer:
    additionalProperties: false
    properties:
      name:
        type: string
  google:
    description: Google specific configuration.
    properties:
      cloudDnsKey:
        description: A service account key for managing a DNS zone.
        type: string
      kmsAccount:
        description: A service account key for managing a KMS vault.
        type: string
      projectId:
        description: A Google Cloud project ID for accessing DNS zone.
        type: string
    required:
      - cloudDnsKey
      - projectId
  home:
    $ref: '#/definitions/alerts'
  k8s:
    additionalProperties: false
    properties:
      namespaces:
        items:
          additionalProperties: false
          properties:
            disableIstioInjection:
              type: boolean
            disablePolicyChecks:
              type: boolean
            name:
              type: string
          required:
            - name
        type: array
    required:
      - namespaces
  oidc:
    additionalProperties: false
    description: 'Holds many parts used in different locations. Please see keycloak, istio and oauth-proxy all consuming parts.'
    properties:
      adminGroupID:
        type: string
      apiUrl:
        $ref: '#/definitions/url'
      authUrl:
        $ref: '#/definitions/url'
      clientID:
        type: string
      clientSecret:
        type: string
      issuer:
        $ref: '#/definitions/url'
      jwksUri:
        $ref: '#/definitions/url'
      scope:
        type: string
      teamAdminGroupID:
        type: string
      tenantID:
        type: string
      tokenUrl:
        $ref: '#/definitions/url'
      usernameClaimMapper:
        type: string
        description: 'Claim name used by Keycloak to identify incoming users from identity provider'
  otomi:
    additionalProperties: false
    properties:
      hasCloudLB:
        default: false
        description: 'Set this to true when an external LB exists or needs to be started (AWS ALB, Azure AppGW, Google Apigee). This will then be configured through ingress controllers. Expects existing LBs to terminate https. Currently this is only working correctly for Azure, and not for AWS and Google. AWS is close to completion.'
        type: boolean
      isHomeMonitored:
        default: false
        description: Whether this cluster is home monitored (like when under a Premium SLA). Sends criticals home.
        type: boolean
      isManaged:
        default: true
        description: Whether masters are managed and not under control. Set this to false when onprem.
        type: boolean
      isMultitenant:
        default: true
        description: Whether to separate team metrics and logs. Disabling this lets everybody be admin and see everything.
        type: boolean
      mode:
        default: ee
        description: The otomi-core edition. Either community edition (ce) or enterprise edition (ee).
        enum:
          - ce
          - ee
        type: string
      pullSecret:
        default: ''
        description: The pullsecret to deploy the Otomi API and Console. Requires an Otomi license.
        type: string
      teamPrefix:
        default: team-
        description: The prefix to use in URLs for team domains.
        pattern: '^[a-z]+[-]{1}$'
        type: string
      addons:
        description: Manage addon configuration
        additionalProperties: false
        properties:
          conftest:
            properties:
              enabled:
                type: boolean
                default: true
                description: Use this flag to enable conftest for policy validation

  policies:
    type: object
    description: |
      List of policy objects used by Open Policy Agent tools (Conftest, Gatekeeper) to run policy based validation against both in-cluster Kubernetes contexts and plain Yaml resources
    additionalProperties: false
    properties:
      banned-image-tags:
        additionalProperties: false
        required: [enabled]
        properties:
          tags:
            type: array
            items:
              type: string
          enabled:
            type: boolean
            default: false
      container-limits:
        additionalProperties: false
        required: [enabled]
        properties:
          cpu:
            '$ref': '#/definitions/cpuQuantity'
          memory:
            '$ref': '#/definitions/memoryQuantity'
          enabled:
            type: boolean
            default: false
      psp-allowed-repos:
        additionalProperties: false
        required: [enabled]
        properties:
          repos:
            type: array
            items:
              type: string
          enabled:
            type: boolean
            default: false
      psp-host-filesystem:
        additionalProperties: false
        required: [enabled]
        properties:
          allowedHostPaths:
            type: array
            items:
              type: object
              required: [pathPrefix, readOnly]
              properties:
                pathPrefix:
                  type: string
                readOnly:
                  type: boolean
              additionalProperties: false
          enabled:
            type: boolean
            default: false
      psp-allowed-users:
        additionalProperties: false
        required: [enabled]
        properties:
          runAsUser:
            type: object
            additionalProperties: false
            required: [rule]
            properties:
              rule:
                type: string
                enum: [RunAsAny, MustRunAsNonRoot, MustRunAs]
              ranges:
                type: array
                items:
                  type: object
                  additionalProperties: false
                  required: [min, max]
                  properties:
                    min:
                      type: integer
                    max:
                      type: integer
          runAsGroup:
            type: object
            properties:
              rule:
                type: string
                enum: [RunAsAny, MayRunAs, MustRunAs]
              ranges:
                type: array
                items:
                  type: object
                  additionalProperties: false
                  required: [min, max]
                  properties:
                    min:
                      type: integer
                    max:
                      type: integer
          supplementalGroups:
            type: object
            properties:
              rule:
                type: string
                enum: [RunAsAny, MayRunAs, MustRunAs]
              ranges:
                type: array
                items:
                  type: object
                  additionalProperties: false
                  required: [min, max]
                  properties:
                    min:
                      type: integer
                    max:
                      type: integer
          fsGroup:
            type: object
            properties:
              rule:
                type: string
                enum: [RunAsAny, MayRunAs, MustRunAs]
              ranges:
                type: array
                items:
                  type: object
                  additionalProperties: false
                  required: [min, max]
                  properties:
                    min:
                      type: integer
                    max:
                      type: integer
          enabled:
            type: boolean
            default: false
      psp-host-security:
        additionalProperties: false
        required: [enabled]
        properties:
          enabled:
            type: boolean
            default: false
      psp-host-networking-ports:
        additionalProperties: false
        required: [enabled]
        properties:
          enabled:
            type: boolean
            default: false
      psp-privileged:
        additionalProperties: false
        required: [enabled]
        properties:
          enabled:
            type: boolean
            default: false
      psp-capabilities:
        additionalProperties: false
        required: [enabled]
        properties:
          enabled:
            type: boolean
            default: false
          allowedCapabilities:
            type: array
            items:
              type: string
          requiredDropCapabilities:
            type: array
            items:
              type: string
      psp-forbidden-sysctls:
        additionalProperties: false
        required: [enabled]
        properties:
          enabled:
            type: boolean
            default: false
          forbiddenSysctls:
            type: array
            items:
              type: string
      psp-apparmor:
        additionalProperties: false
        required: [enabled]
        properties:
          enabled:
            type: boolean
            default: false
          allowedProfiles:
            type: array
            items:
              type: string
      psp-seccomp:
        additionalProperties: false
        required: [enabled]
        properties:
          enabled:
            type: boolean
            default: false
          allowedProfiles:
            type: array
            items:
              type: string
      psp-selinux:
        additionalProperties: false
        required: [enabled]
        properties:
          enabled:
            type: boolean
            default: false
          seLinuxContext:
            type: string
            enum: [MustRunAs, RunAsAny]
          allowedSELinuxOptions:
            type: array
            items:
              type: object
              additionalProperties: false
              properties:
                level:
                  type: string
                role:
                  type: string
                type:
                  type: string
                user:
                  type: string
  proxies:
    items:
      additionalProperties: false
      properties:
        name:
          type: string
        namespace:
          type: string
        path:
          type: string
      required:
        - name
        - namespace
        - path
    type: array
  services:
    items:
      additionalProperties: false
      properties:
        authz:
          properties:
            forwardOriginalToken:
              type: boolean
            workload:
              properties:
                app:
                  type: string
                app.kubernetes.io/instance:
                  type: string
                app.kubernetes.io/name:
                  type: string
                component:
                  type: string
          required:
            - workload
        forwardPath:
          type: boolean
        hide:
          type: boolean
        host:
          type: string
        isPublic:
          type: boolean
        isShared:
          type: boolean
        logo:
          properties:
            name:
              type: string
          required:
            - name
        name:
          type: string
        namespace:
          type: string
        ownHost:
          type: boolean
        path:
          type: string
        paths:
          anyOf:
            - type: 'null'
            - items:
                type: string
              type: array
        port:
          type: integer
        svc:
          type: string
      required:
        - name
        - namespace
        - svc
    type: array
  smtp:
    additionalProperties: false
    properties:
      auth_identity:
        type: string
      auth_password:
        type: string
      auth_secret:
        type: string
      auth_username:
        type: string
      from:
        $ref: '#/definitions/email'
        description: The "from" address. Defaults to alerts@$clusterDomain.
      hello:
        type: string
      smarthost:
        $ref: '#/definitions/hostPort'
        description: 'The smtp host:port combination.'
    required:
      - smarthost
  sops:
    description: DON'T EDIT THIS YOURSELF! This is a SOPS governed property. Exists here only to avoid warnings in console.
  teamConfig:
    additionalProperties: false
    properties:
      services:
        description: An internal otomi object (do not edit it).
        type: array
      teams:
        additionalProperties: false
        patternProperties:
          '^[a-z-]+$':
            $ref: '#/definitions/team'
required:
  - alerts
  - clouds
  - customer
  - oidc
  - otomi
  - teamConfig
  - services
