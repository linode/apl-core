---
'$schema': 'http://json-schema.org/draft-07/schema'
type: object
additionalProperties: false
definitions:
  k8sVersion:
    type: string
    default: '1.18'
    enum: ['1.16', '1.17', '1.18']
    description: The cluster k8s version. Otomi supports 2 minor versions backwards compatibility from the suggested default.
  domain:
    type: string
    pattern: ^(([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9\-]*[a-zA-Z0-9])\.)*([A-Za-z0-9]|[A-Za-z0-9][A-Za-z0-9\-]*[A-Za-z0-9])$
  registry:
    type: string
    pattern: ^[a-z0-9]+(?:[._-][a-z0-9]+)*$
  repository:
    type: string
    pattern: ^[a-z0-9]+(?:[/._-]{1,2}[a-z0-9]+)*$
    description: A container image repository
  memoryQuantity:
    type: string
    pattern: ^[0-9]+\.?[0-9]+(E|P|T|G|M|K|Ei|Pi|Ti|Gi|Mi|Ki)?$
    description: Amount of memory. Valid units are E|P|T|G|M|K|Ei|Pi|Ti|Gi|Mi|Ki
    examples:
      - 1Mi
      - 0.5M
  cpuQuantity:
    type: string
    pattern: ^([0-9]+\.[0-9]{1,2})|([0-9]{2,3}m)?$
    description: Amount of cores, or slice of cpu in millis.
    examples:
      - '1'
      - 200m
  env:
    type: string
    pattern: ^[a-zA-Z0-9_]*$
  labelsAnnotations:
    type: object
    additionalProperties: false
    patternProperties:
      ? '^((([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9\-]*[a-zA-Z0-9])\.)*([A-Za-z0-9]|[A-Za-z0-9][A-Za-z0-9\-]*[A-Za-z0-9]){1,253}\/)?([a-z0-9A-Z]+[a-z0-9A-Z-_.]+[a-z0-9A-Z]){1,63}$'
      : type: string
        pattern: ^((.){1,253}\/)?(.){1,63}$
  annotations:
    '$ref': '#/definitions/labelsAnnotations'
    description: A set of annotations.
  labels:
    '$ref': '#/definitions/labelsAnnotations'
    description: A set of labels.
  idName:
    type: string
    pattern: ^[a-z0-9]([-a-z0-9]*[a-z0-9])?$
    description: A lowercase name that starts with a letter and may contain dashes.
  imageSimple:
    title: Container image
    type: object
    additionalProperties: false
    properties:
      pullPolicy:
        type: string
        enum: [IfNotPresent, Always]
        default: IfNotPresent
      tag:
        type: string
  image:
    title: Container image
    type: object
    additionalProperties: false
    properties:
      pullPolicy:
        type: string
        enum: [IfNotPresent, Always]
        default: IfNotPresent
      repository:
        '$ref': '#/definitions/repository'
      tag:
        type: string
  portNumber:
    type: number
    minimum: 80
    maximum: 32768
  resource:
    type: object
    additionalProperties: false
    properties:
      cpu:
        '$ref': '#/definitions/cpuQuantity'
      memory:
        '$ref': '#/definitions/memoryQuantity'
    required: [cpu, memory]
  resources:
    title: Pod resources
    description: Compute resources for containers
    type: object
    additionalProperties: false
    properties:
      requests:
        description: Requested resources (guaranteed)
        '$ref': '#/definitions/resource'
      limits:
        description: Requested resources (best effort)
        '$ref': '#/definitions/resource'
  secret:
    type: object
    properties:
      id:
        type: string
        readOnly: true
      name:
        '$ref': '#/definitions/idName'
    oneOf:
      - title: Docker Registry
        properties:
          type:
            type: string
            enum: [docker-registry]
            default: docker-registry
          server:
            '$ref': '#/definitions/registry'
          username:
            type: string
          password:
            type: string
        required: [server, username, password]
      - title: Generic
        properties:
          type:
            type: string
            enum: [generic]
            default: generic
          entries:
            type: array
            description: Key names and their values
            items:
              type: object
              properties:
                key:
                  description: Key or file name
                  example: secretstuff.conf
                  type: string
                value:
                  description: Value to be encrypted
                  example: password=yoursecretpassword
                  type: string
              required: [key, value]
        required: [entries]
      - title: TLS
        properties:
          type:
            type: string
            enum: [tls]
            default: tls
          crt:
            description: The PEM encoded public key certificate content
            type: string
          key:
            description: The private key certificate content
            type: string
          ca:
            description: The CA certificate content
            type: string
        required: [crt, key]
    required:
      - name
      - type
  alerts:
    properties:
      groupInterval:
        type: string
        default: 5m
        description: How long to wait before sending a notification about new alerts that are added to a group of alerts for which an initial notification has already been sent. (Usually ~5m or more.)
      repeatInterval:
        type: string
        default: 3h
        description: How long to wait before sending a notification again if it has already been sent successfully for an alert. (Usually ~3h or more).
      receiver:
        type: string
        enum:
          - slack
          - msteams
        default: slack
        description: A notification receiver. You can only choose one of Slack or MS Teams in simple configuration mode.
      slack:
        type: object
        additionalProperties: false
        properties:
          url:
            type: string
            description: A Slack webhook URL.
          channel:
            type: string
            default: mon-otomi
            description: 'The Slack channel for non-critical notifications. This channel, as well as one with the suffix "-crit" (for criticals) should exist.'
        required: [url]
      msteams:
        type: object
        additionalProperties: false
        properties:
          highPrio:
            type: string
            description: The low prio web hook
          lowPrio:
            type: string
            description: The high prio web hook
        required: [highPrio, lowPrio]
    required: [receiver]
  cloud:
    description: A common cloud configuration
    type: object
    additionalProperties: false
    properties:
      domain:
        '$ref': '#/definitions/domain'
      clusters:
        patternProperties:
          '^[a-z-]+$':
            '$ref': '#/definitions/cluster'
        additionalProperties: false
    required: [domain, clusters]
  cloudAzure:
    description: An azure cloud specific configuration
    type: object
    additionalProperties: false
    properties:
      diskType:
        type: string
        enum:
          [
            Standard_LRS,
            Standard_GRS,
            Standard_RAGRS,
            Standard_ZRS,
            Premium_LRS,
            Premium_ZRS,
            Standard_GZRS,
            Standard_RAGZRS,
          ]
        description: An azure disk type (SKU Type)
      resourceGroup:
        type: string
        description: An azure resource group
      subscriptionId:
        type: string
        description: An azure subscription ID
      tenantId:
        type: string
        description: An azure tenant ID
    required: [diskType, resourceGroup, subscriptionId, tenantId]
  cloudGoogle:
    description: A google cloud specific configuration
    type: object
    additionalProperties: false
    properties:
      cloudDnsKey:
        type: integer
        description: A service account key for managing a DNS zone
      projectId:
        type: string
        description: A Google Cloud project ID for accessing DNS zone
    required: [cloudDnsKey, projectId]
  cluster:
    type: object
    additionalProperties: false
    properties:
      enabled:
        type: boolean
        default: true
      apiName:
        type: string
        description: Only used for API/UI to show in app.
      apiServer:
        type: string
        description: Used by kubectl for local deployment to target cluster.
      dnsProvider:
        type: string
        description: Only set it if you want DNS provider to be different than cloud provider ot this cluster.
        enum: [azure, google, aws]
      dnsZones:
        type: array
        items:
          '$ref': '#/definitions/domain'
        description: Extra dns zones that the cluster can administer (see dns). Team services can use this to publish their URLs on.
      domain:
        '$ref': '#/definitions/domain'
        description: Base cloud domain for the cluster domain. Also added to list of dns zones in the Otomi Console.
      entrypoint:
        type: string
        description: A Kubernetes API public IP address (onprem only)
      k8sVersion:
        '$ref': '#/definitions/k8sVersion'
      otomiVersion:
        type: string
        default: latest
        description: 'Please pin this a valid release version found in the repo. Suggestion: try the most recent stable version.'
      region:
        type: string
        description: Dependent on provider.
        examples:
          - europe-west4
          - eu-central-1
          - westeurope
      vpcID:
        type: string
        description: AWS only. If provided will override autodiscovery from metadata.
    required: [apiServer, k8sVersion, otomiVersion, region]
  team:
    type: object
    additionalProperties: false
    properties:
      azure:
        type: object
      id:
        '$ref': '#/definitions/idName'
        description: Must be the same as the name.
      clusters:
        type: array
        items:
          type: string
      oidc:
        type: object
        additionalProperties: false
        properties:
          groupMapping:
            type: string
            description: IDP group id to map onto this team.
      password:
        type: string
        description: Will be used to separate team resources.
      secrets:
        type: array
        items:
          '$ref': '#/definitions/secret'
      services:
        type: array
        items:
          type: object
          additionalProperties: false
          properties:
            id:
              type: string
              description: Unique identifier created by and used in API. Optional.
            isPublic:
              type: boolean
              description: If true then no SSO will be used.
              default: false
            internal:
              type: boolean
              description: If true, service is not going to be exposed to the public domain
              default: false
            domain:
              type: string
              description: A custom service domain name
            name:
              '$ref': '#/definitions/idName'
              description: Short name. Will be used for generation of knative service name, as well as service URL.
            ownHost:
              type: boolean
              description: When true the service will get it's own domain by prefixing the app name to the team domain. Mostly set to true. This will probably be removed soon.
              default: true
              # deprecated: true
            ksvc:
              type: object
              description: Details for a knative service that will be deployed and operated.
              additionalProperties: false
              properties:
                scaleToZero:
                  title: Scale to zero
                  description: Scales to zero after 60 seconds and needs approximately 8 seconds to start back up.
                  type: boolean
                  default: false
                image:
                  '$ref': '#/definitions/image'
                secrets:
                  type: array
                  title: Secrets
                  nullable: true
                  items:
                    type: object
                    additionalProperties: false
                    properties:
                      name:
                        type: string
                      entries:
                        title: Entries
                        type: array
                        items:
                          type: string
                        uniqueItems: true
                    required: [name]
                env:
                  title: Environment variables
                  # description: Environment variables for containers
                  type: array
                  nullable: true
                  items:
                    type: object
                    additionalProperties: false
                    properties:
                      name:
                        '$ref': '#/definitions/env'
                      value:
                        type: string
                        maxLength: 131072
                    required: [name, value]
                resources:
                  '$ref': '#/definitions/resources'
                annotations:
                  '$ref': '#/definitions/annotations'
                autoCD:
                  title: Continuous delivery pipeline
                  description: NOT IN USE YET! Deploys new images based on a tagging strategy.
                  type: object
                  additionalProperties: false
                  oneOf:
                    - title: 'Off'
                      nullable: true
                      additionalProperties: false
                    - title: Semver versioning
                      nullable: true
                      properties:
                        additionalProperties: false
                        tagMatcher:
                          type: string
                          enum: [semver]
                          default: semver
                        semver:
                          title: Semver version pattern
                          type: string
                          example: 'PATCH only: "~1.1", MINOR and PATCH only "~1", ALL "*",  ">=1.2.3-0"'
                          description:
                            'Use this filter if your images tags follow semantic versioning rules (MAJOR.MINOR.PATCH). E.g.:
                            PATCH only: "~1.1", MINOR and PATCH only "~1", ALL "*"'
                      required: [semver]
                    - title: Glob pattern matching
                      properties:
                        tagMatcher:
                          type: string
                          enum: [glob]
                          default: glob
                        glob:
                          title: Glob string pattern
                          type: string
                          description: 'Use this filter if you want to make simple non-standard patterns. E.g.: "master-v1.*.*"'
                          example: 'master-v1.*.*'
                      required: [glob]
                      additionalProperties: false
            svc:
              '$ref': '#/definitions/idName'
              description: When given a backing k8s service is expected to be deployed with this name, which will be exposed through this team service.
            isShared:
              type: boolean
              description: When true the service will get it's own domain by prefixing the app name to the cluster domain. Mostly used by core apps.
            paths:
              type: array
              items:
                type: string
                description: |
                  Path mapping to only let this path go to the service. This allows micro services to operate on the same domain and port.
                  When left empty all paths will go to this service.
            forwardPath:
              type: boolean
              description: Wether to forward the path into the service, or 'terminate' it.
              default: false
            port:
              '$ref': '#/definitions/portNumber'
              description: Points to the backing k8s service (only used when 'svc' is set).
              default: 80
            authz:
              type: object
              description: Identifies a workload to authorize.
              additionalProperties: false
              properties:
                forwardOriginalToken:
                  type: boolean
                  description: If true istio will forward the bearer token instead of removing it from the headers.
                  default: false
                workload:
                  '$ref': '#/definitions/labelsAnnotations'
          required: [id, name]
    required: [id]
properties:
  alerts:
    '$ref': '#/definitions/alerts'
  charts:
    type: object
    additionalProperties: false
    properties:
      jobs:
        type: object
        additionalProperties: false
        patternProperties:
          'certs-aws|harbor|ingress-azure|keycloak':
            type: object
            properties:
              image:
                '$ref': '#/definitions/image'
      cert-manager:
        type: object
        additionalProperties: false
        properties:
          azureClientSecret:
            type: string
          email:
            type: string
          provider:
            type: object
            additionalProperties: false
            properties:
              azure:
                type: object
                additionalProperties: false
                properties:
                  azuredns:
                    type: object
                    additionalProperties: false
                    properties:
                      clientID:
                        type: string
                      clientSecretSecretRef:
                        additionalProperties: false
                        properties:
                          key:
                            type: string
                          name:
                            type: string
                        required:
                          - name
                          - key
                        type: object
                      hostedZoneName:
                        type: string
                      resourceGroupName:
                        type: string
                      subscriptionID:
                        type: string
                      tenantID:
                        type: string
                    required:
                      - clientID
                      - clientSecretSecretRef
                      - tenantID
                      - subscriptionID
                      - resourceGroupName
                      - hostedZoneName
              google:
                type: object
                additionalProperties: false
                properties:
                  clouddns:
                    type: object
                    additionalProperties: false
                    properties:
                      project:
                        type: string
                      serviceAccountSecretRef:
                        type: object
                        additionalProperties: false
                        properties:
                          key:
                            type: string
                          name:
                            type: string
              aws:
                type: object
                additionalProperties: false
                properties:
                  route53:
                    type: object
                    additionalProperties: false
                    properties:
                      region:
                        type: string
          stage:
            type: string
            description: |
              The Let’s Encrypt environment that is used for issuing certificates.
              The 'production' environment issues trusted certificates but has narrow rate limits, whereas the 'staging' environment issues untrusted certificates but provides broader rate limits.
              Read more about rate limits: https://letsencrypt.org/docs/rate-limits/
            enum: ['staging', 'production']
      cluster-overprovisioner:
        type: object
        additionalProperties: false
        properties:
          enabled:
            type: boolean
          memory:
            '$ref': '#/definitions/memoryQuantity'
          cpu:
            '$ref': '#/definitions/cpuQuantity'
      drone:
        type: object
        additionalProperties: false
        properties:
          enabled:
            type: boolean
            default: false
          adminUser:
            type: string
          debug:
            type: boolean
            default: false
          sharedSecret:
            type: string
            description: A secret used by drone-admit-members plugin
          githubAdmins:
            type: object
            additionalProperties: false
            properties:
              org:
                type: string
              team:
                type: string
              token:
                type: string
          orgsFilter:
            type: string
          repoFilter:
            type: string
          resources:
            additionalProperties: false
            properties:
              runner:
                '$ref': '#/definitions/resources'
              server:
                '$ref': '#/definitions/resources'
          sourceControl:
            type: object
            additionalProperties: false
            properties:
              github:
                type: object
                additionalProperties: false
                properties:
                  clientID:
                    type: string
                  clientSecretValue:
                    type: string
                  server:
                    type: string
              provider:
                type: string
      external-dns:
        type: object
        additionalProperties: false
        patternProperties:
          'aws|azure':
            type: object
            properties:
              region:
                type: string
            required: [region]
          azure:
            type: object
          domainFilters:
            type: array
            items:
              type: string
          logLevel:
            type: string
            enum: [debug, info, warning, error]
            default: info
          zoneIdFilters:
            type: array
            items:
              type: string
      gatekeeper-operator:
        type: object
        additionalProperties: false
        properties:
          enabled:
            type: boolean
      harbor:
        type: object
        additionalProperties: false
        properties:
          adminPassword:
            type: string
          enabled:
            type: boolean
          persistence:
            additionalProperties: false
            type: object
            properties:
              imageChartStorage:
                type: object
                additionalProperties: false
                properties:
                  gcs:
                    type: object
                    additionalProperties: false
                    properties:
                      bucket:
                        type: string
                      encodedkey:
                        type: string
                      rootdirectory:
                        type: string
                  type:
                    type: string
          secretKey:
            type: string
      ingress-azure:
        type: object
        description: A chart for Azure Application Gateway
        additionalProperties: false
        properties:
          appgw:
            additionalProperties: false
            description: Application Gateway
            properties:
              name:
                description: A name of the Application Gateway
                type: string
              resourceGroup:
                description: A name of the Azure Resource Group in which Application Gateway was created
                type: string
              subnetName:
                description: A subnet of the application gateway
                type: string
              subnetPrefix:
                description: A subnet in CIDR notation
                examples:
                  - 10.1.0.0/16
                type: string
              subscriptionId:
                description: The Azure Subscription ID in which Application Gateway resides
                type: string
            required:
              - subscriptionId
              - resourceGroup
              - name
              - subnetName
              - subnetPrefix
          armAuth:
            type: object
            additionalProperties: false
            description: A service Principal secret ey An explanation about the purpose of this instance.
            properties:
              secretJSON:
                description: A service Principal secret JSON key (base64 encoded)
                type: string
            required:
              - secretJSON
        required:
          - armAuth
          - appgw

      istio:
        type: object
        additionalProperties: false
        properties:
          addonComponents:
            type: object
            additionalProperties: false
            properties:
              grafana:
                type: object
                additionalProperties: false
                properties:
                  enabled:
                    type: boolean
              kiali:
                type: object
                additionalProperties: false
                properties:
                  enabled:
                    type: boolean
              prometheus:
                type: object
                additionalProperties: false
                properties:
                  enabled:
                    type: boolean
              tracing:
                type: object
                additionalProperties: false
                properties:
                  enabled:
                    type: boolean
          gateways:
            type: object
            additionalProperties: false
            properties:
              istio-egressgateway:
                type: object
                additionalProperties: false
                properties:
                  resources:
                    '$ref': '#/definitions/resources'
              istio-ingressgateway:
                type: object
                additionalProperties: false
                properties:
                  resources:
                    '$ref': '#/definitions/resources'
          global:
            type: object
            additionalProperties: false
            properties:
              logging:
                type: object
                properties:
                  level:
                    type: string
              mtls:
                type: object
                additionalProperties: false
                properties:
                  enabled:
                    type: boolean
              proxy:
                type: object
                additionalProperties: false
                properties:
                  resources:
                    '$ref': '#/definitions/resources'
              sds:
                type: object
                additionalProperties: false
                properties:
                  enabled:
                    type: boolean
          mixer:
            type: object
            additionalProperties: false
            properties:
              policy:
                type: object
                additionalProperties: false
                properties:
                  enabled:
                    type: boolean
                  resources:
                    '$ref': '#/definitions/resources'
              telemetry:
                type: object
                additionalProperties: false
                properties:
                  enabled:
                    type: boolean
                  resources:
                    type: object
                    additionalProperties: false
                    properties:
                      limits:
                        type: object
                        additionalProperties: false
                        properties:
                          cpu:
                            type: string
                          memory:
                            type: string
                      requests:
                        type: object
                        additionalProperties: false
                        properties:
                          cpu:
                            type: string
                          memory:
                            type: string
          pilot:
            type: object
            additionalProperties: false
            properties:
              resources:
                '$ref': '#/definitions/resources'
              traceSampling:
                type: number
      kube-descheduler:
        type: object
        additionalProperties: false
        properties:
          enabled:
            type: boolean
            default: true
          schedule:
            type: string
            default: '*/30 * * * *'
      keycloak:
        type: object
        additionalProperties: false
        properties:
          enabled:
            type: boolean
          idp:
            type: object
            additionalProperties: false
            properties:
              alias:
                type: string
          realm:
            type: string
          theme:
            type: string
            enum: [default]
      loki:
        type: object
        additionalProperties: false
        properties:
          adminPassword:
            type: string
          persistence:
            type: object
            additionalProperties: false
            properties:
              size:
                type: string
          retention:
            type: object
            additionalProperties: false
            properties:
              duration:
                type: string
              period:
                type: string
          storageType:
            type: string
      nginx-ingress:
        type: object
        additionalProperties: false
        properties:
          autoscaling:
            type: object
            additionalProperties: false
            properties:
              enabled:
                type: boolean
          resources:
            '$ref': '#/definitions/resources'
      oauth2-proxy:
        type: object
        additionalProperties: false
        properties:
          config:
            type: object
            properties:
              cookieSecret:
                type: string
      otomi-api:
        type: object
        additionalProperties: false
        properties:
          git:
            type: object
            additionalProperties: false
            properties:
              branch:
                type: string
              email:
                type: string
              localPath:
                type: string
              password:
                type: string
              repoUrl:
                type: string
              user:
                type: string
          image:
            '$ref': '#/definitions/imageSimple'
          tools:
            type: object
            additionalProperties: false
            properties:
              gcloudServiceKey:
                type: string
              image:
                '$ref': '#/definitions/imageSimple'

      otomi-console:
        type: object
        additionalProperties: false
        properties:
          image:
            '$ref': '#/definitions/imageSimple'
      prometheus-operator:
        type: object
        properties:
          additionalProperties: false
          alertmanager:
            type: object
            additionalProperties: false
            properties:
              groupInterval:
                type: string
              receiver:
                type: string
              repeatInterval:
                type: string
              slack:
                additionalProperties: false
                type: object
                properties:
                  channel:
                    type: string
                  url:
                    type: string
          grafana:
            type: object
            additionalProperties: false
            properties:
              adminPassword:
                type: string
          prometheus:
            type: object
            additionalProperties: false
            properties:
              storageSize:
                type: string
      redis-shared:
        type: object
        additionalProperties: false
        properties:
          enabled:
            type: boolean
      sitespeed:
        type: object
        additionalProperties: false
        properties:
          enabled:
            type: boolean
          pvc:
            type: object
            additionalProperties: false
            properties:
              graphite:
                type: string
              results:
                type: string
          retention:
            type: string
          schedule:
            type: string
      weave-scope:
        enabled: boolean
        default: false
  clouds:
    additionalProperties: false
    type: object
    properties:
      aws:
        '$ref': '#/definitions/cloud'
      azure:
        allOff:
          - '$ref': '#/definitions/cloud'
          - '$ref': '#/definitions/cloudAzure'
      google:
        allOff:
          - '$ref': '#/definitions/cloud'
          - '$ref': '#/definitions/cloudGoogle'
      onprem:
        '$ref': '#/definitions/cloud'
  customer:
    type: object
    additionalProperties: false
    properties:
      name:
        type: string
  oidc:
    type: object
    additionalProperties: false
    properties:
      clientID:
        type: string
      clientSecret:
        type: string
      idp:
        type: object
        additionalProperties: false
        properties:
          adminGroupID:
            type: string
          clientID:
            type: string
          clientSecret:
            type: string
          issuer:
            type: string
          teamAdminGroupID:
            type: string
          tenantID:
            type: string
      scope:
        type: string
  otomi:
    type: object
    additionalProperties: false
    properties:
      hasCloudLB:
        type: boolean
        description:
          Set this to true when an external LB exists or needs to be started (AWS ALB, Azure AppGW, Google Apigee).
          This will then be configured through ingress controllers. Expects existing LBs to terminate https.
          Currently this is only working correctly for Azure, and not for AWS and Google. AWS is close to completion.
        default: false
      isManaged:
        type: boolean
        description: Wether masters are managed and not under control. Set this to false when onprem.
        default: true
      isMultitenant:
        type: boolean
        description: Wether to separate team metrics and logs. Disabling this lets everybody be admin and see everything.
        default: true
      isRedkubesMonitored:
        type: boolean
        description: Wether this cluster is monitored under a RedKubes Premium SLA. Sends all notifications to RedKubes.
        default: false
      mode:
        type: string
        default: ce
        description: The otomi-core edition. Either community edition (ce) or enterprise edition (ee)
        enum: [ce, ee]
      pullSecret:
        type: string
        description: The pullsecret to deploy the Otomi API and Console. Requires an Otomi license.
        default: ''
      teamPrefix:
        type: string
        default: team-
        description: The prefix to use in URLs for team domains.
        pattern: ^[a-z]+[-]{1}$
  sops:
    description: DON'T EDIT THIS YOURSELF! This is a SOPS governed property. Exists here only to avoid warnings in console.
  teamConfig:
    type: object
    additionalProperties: false
    properties:
      teams:
        type: object
        additionalProperties: false
        patternProperties:
          '^[a-z-]+$':
            '$ref': '#/definitions/team'
      services:
        description: An internal otomi object (do not edit it)
        type: array

  cluster:
    description: An internal otomi object (do not edit it)
    type: object

  k8s:
    type: object
    additionalProperties: false
    properties:
      namespaces:
        type: array
        items:
          type: object
          additionalProperties: false
          properties:
            disableIstioInjection:
              type: boolean
            name:
              type: string
          required:
            - name
    required:
      - namespaces

  proxies:
    type: array
    items:
      type: object
      additionalProperties: false
      properties:
        name:
          type: string
        namespace:
          type: string
        path:
          type: string
      required:
        - name
        - namespace
        - path
  services:
    type: array
    items:
      type: object
      additionalProperties: false
      properties:
        isPublic:
          type: boolean
        name:
          type: string
        namespace:
          type: string
        ownHost:
          type: boolean
        svc:
          type: string
        isShared:
          type: boolean
        paths:
          anyOf:
            - type: 'null'
            - type: array
              items:
                type: string
        forwardPath:
          type: boolean
        hide:
          type: boolean
        port:
          type: integer
        authz:
          type: object
          properties:
            forwardOriginalToken:
              type: boolean
            workload:
              type: object
              properties:
                app.kubernetes.io/name:
                  type: string
                app.kubernetes.io/instance:
                  type: string
                app:
                  type: string
                component:
                  type: string
          required:
            - workload
        host:
          type: string
        path:
          type: string
        logo:
          type: object
          properties:
            name:
              type: string
          required:
            - name
      required:
        - name
        - namespace
        - svc

  toolsVersion:
    type: string

required: [alerts, clouds, customer, oidc, otomi, teamConfig, k8s, services, toolsVersion]
