---
'$schema': 'http://json-schema.org/draft-07/schema'
type: object
additionalProperties: false
definitions:
  alerts:
    properties:
      drone:
        default: slack
        enum:
          - slack
          - msteams
        type: string
      email:
        additionalProperties: false
        properties:
          critical:
            $ref: '#/definitions/email'
            description: One or more email addresses (comma separated) for critical events.
          nonCritical:
            $ref: '#/definitions/email'
            description: One or more email addresses (comma separated) for non-critical events.
        type: object
      groupInterval:
        default: 5m
        description: How long to wait before sending a notification about new alerts that are added to a group of alerts for which an initial notification has already been sent. (Usually ~5m or more.)
        type: string
      msteams:
        additionalProperties: false
        properties:
          highPrio:
            description: The low prio web hook
            type: string
          lowPrio:
            description: The high prio web hook
            type: string
        type: object
      receivers:
        description: Notification receivers.
        items:
          enum:
            - slack
            - msteams
            - email
          type: string
        type: array
      repeatInterval:
        default: 3h
        description: How long to wait before sending a notification again if it has already been sent successfully for an alert. (Usually ~3h or more).
        type: string
      slack:
        additionalProperties: false
        properties:
          channel:
            default: mon-otomi
            description: The Slack channel for non-critical notifications.
            type: string
          channelCrit:
            default: mon-otomi
            description: The Slack channel for critical notifications.
            type: string
          url:
            $ref: '#/definitions/url'
            description: A Slack webhook URL.
        type: object
    type: object
  annotations:
    $ref: '#/definitions/labelsAnnotations'
    description: A set of annotations.
  azureMonitor:
    properties:
      appInsightsApiKey:
        description: An Azure AppInsights client secret (defaults to clientSecret)
        type: string
      appInsightsAppId:
        description: An Azure AppInsights client id (defaults to clientId)
        type: string
      clientId:
        description: An Azure client id
        type: string
      clientSecret:
        description: An Azure client secret
        type: string
      logAnalyticsClientId:
        description: An Azure client secret (defaults to clientSecret)
        type: string
      logAnalyticsClientSecret:
        description: An Azure client secret (defaults to clientSecret)
        type: string
      logAnalyticsTenantId:
        description: An Azure tenant id (defaults to tenantId)
        type: string
      logAnalyticsWorkspace:
        description: An Azure monitor log analytics workspace
        type: string
    type: object
  cloud:
    description: A common cloud configuration
    properties:
      clusters:
        additionalProperties: false
        patternProperties:
          '^[a-z-]+$':
            $ref: '#/definitions/cluster'
      domain:
        $ref: '#/definitions/domain'
    required:
      - domain
      - clusters
    type: object
  cluster:
    additionalProperties: false
    properties:
      apiName:
        description: Only used for API/UI to show in app.
        type: string
      apiServer:
        description: Used by kubectl for local deployment to target cluster.
        type: string
      dnsProvider:
        description: Only set it if you want DNS provider to be different than cloud provider ot this cluster.
        enum:
          - azure
          - google
          - aws
        type: string
      dnsZones:
        description: Extra dns zones that the cluster can administer (see dns). Team services can use this to publish their URLs on.
        items:
          $ref: '#/definitions/domain'
        type: array
      domain:
        $ref: '#/definitions/domain'
        description: Base cloud domain for the cluster domain. Also added to list of dns zones in the Otomi Console.
      enabled:
        default: true
        type: boolean
      entrypoint:
        description: A Kubernetes API public IP address (onprem only)
        type: string
      k8sVersion:
        $ref: '#/definitions/k8sVersion'
      otomiVersion:
        default: latest
        description: 'Please pin this a valid release version found in the repo. Suggestion: try the most recent stable version.'
        type: string
      region:
        description: Dependent on provider.
        examples:
          - europe-west4
          - eu-central-1
          - westeurope
        type: string
      vpcID:
        description: AWS only. If provided will override autodiscovery from metadata.
        type: string
    required:
      - apiServer
      - k8sVersion
      - otomiVersion
      - region
    type: object
  cpuQuantity:
    description: 'Amount of cores, or slice of cpu in millis.'
    examples:
      - '1'
      - 200m
    pattern: '^([0-9]+\.[0-9]{1,2})|([0-9]{2,3}m)?$'
    type: string
  domain:
    pattern: '^(([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9\-]*[a-zA-Z0-9])\.)*([A-Za-z0-9]|[A-Za-z0-9][A-Za-z0-9\-]*[A-Za-z0-9])$'
    type: string
  droneGit:
    properties:
      clientID:
        type: string
      clientSecretValue:
        type: string
    type: object
  email:
    pattern: '^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$'
    type: string
  env:
    pattern: '^[a-zA-Z0-9_]*$'
    type: string
  hostPort:
    pattern: '^(([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9\-]*[a-zA-Z0-9])\.)*([A-Za-z0-9]|[A-Za-z0-9][A-Za-z0-9\-]*[A-Za-z0-9]):()([1-9]|[1-5]?[0-9]{2,4}|6[1-4][0-9]{3}|65[1-4][0-9]{2}|655[1-2][0-9]|6553[1-5])$'
    type: string
  idName:
    description: A lowercase name that starts with a letter and may contain dashes.
    pattern: '^[a-z0-9]([-a-z0-9]*[a-z0-9])?$'
    type: string
  image:
    additionalProperties: false
    properties:
      pullPolicy:
        default: IfNotPresent
        enum:
          - IfNotPresent
          - Always
        type: string
      repository:
        $ref: '#/definitions/repository'
      tag:
        type: string
    title: Container image
    type: object
  imageSimple:
    additionalProperties: false
    properties:
      pullPolicy:
        default: IfNotPresent
        enum:
          - IfNotPresent
          - Always
        type: string
      tag:
        type: string
    title: Container image
    type: object
  k8sVersion:
    default: '1.18'
    description: The cluster k8s version. Otomi supports 2 minor versions backwards compatibility from the suggested default.
    enum:
      - '1.16'
      - '1.17'
      - '1.18'
    type: string
  labels:
    $ref: '#/definitions/labelsAnnotations'
    description: A set of labels.
  labelsAnnotations:
    additionalProperties: false
    patternProperties:
      ? '^((([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9\-]*[a-zA-Z0-9])\.)*([A-Za-z0-9]|[A-Za-z0-9][A-Za-z0-9\-]*[A-Za-z0-9]){1,253}\/)?([a-z0-9A-Z]+[a-z0-9A-Z-_.]+[a-z0-9A-Z]){1,63}$'
      : pattern: '^((.){1,253}\/)?(.){1,63}$'
        type: string
    type: object
  memoryQuantity:
    description: Amount of memory. Valid units are E|P|T|G|M|K|Ei|Pi|Ti|Gi|Mi|Ki
    examples:
      - 1Mi
      - 0.5M
    pattern: '^[0-9]+\.?[0-9]+(E|P|T|G|M|K|Ei|Pi|Ti|Gi|Mi|Ki)?$'
    type: string
  portNumber:
    maximum: 32768
    minimum: 80
    type: number
  registry:
    pattern: '^[a-z0-9]+(?:[._-][a-z0-9]+)*$'
    type: string
  repoUrl:
    description: Path to a remote git repo without protocol. Will use https to access.
    pattern: '^(.+@)*([\w\d\.]+)(:[\d]+){0,1}/*(.*)$'
    type: string
  repository:
    description: A container image repository
    pattern: '^[a-z0-9]+(?:[/._-]{1,2}[a-z0-9]+)*$'
    type: string
  resource:
    additionalProperties: false
    properties:
      cpu:
        $ref: '#/definitions/cpuQuantity'
      memory:
        $ref: '#/definitions/memoryQuantity'
    required:
      - cpu
      - memory
    type: object
  resources:
    additionalProperties: false
    description: Compute resources for containers
    properties:
      limits:
        $ref: '#/definitions/resource'
        description: Requested resources (best effort)
      requests:
        $ref: '#/definitions/resource'
        description: Requested resources (guaranteed)
    title: Pod resources
    type: object
  scaling:
    description: Min and max nr of replicas
    properties:
      maxReplicas:
        type: number
      minReplicas:
        type: number
    type: object
  secret:
    oneOf:
      - properties:
          password:
            type: string
          server:
            $ref: '#/definitions/registry'
          type:
            default: docker-registry
            enum:
              - docker-registry
            type: string
          username:
            type: string
        required:
          - server
          - username
          - password
        title: Docker Registry
      - properties:
          entries:
            description: Key names and their values
            items:
              properties:
                key:
                  description: Key or file name
                  example: secretstuff.conf
                  type: string
                value:
                  description: Value to be encrypted
                  example: password=yoursecretpassword
                  type: string
              required:
                - key
                - value
              type: object
            type: array
          type:
            default: generic
            enum:
              - generic
            type: string
        required:
          - entries
        title: Generic
      - properties:
          ca:
            description: The CA certificate content
            type: string
          crt:
            description: The PEM encoded public key certificate content
            type: string
          key:
            description: The private key certificate content
            type: string
          type:
            default: tls
            enum:
              - tls
            type: string
        required:
          - crt
          - key
        title: TLS
    properties:
      id:
        readOnly: true
        type: string
      name:
        $ref: '#/definitions/idName'
    required:
      - name
      - type
    type: object
  team:
    additionalProperties: false
    properties:
      alerts:
        $ref: '#/definitions/alerts'
      azureMonitor:
        $ref: '#/definitions/azureMonitor'
      clusters:
        items:
          type: string
        type: array
      id:
        $ref: '#/definitions/idName'
        description: Must be the same as the name.
      oidc:
        additionalProperties: false
        properties:
          groupMapping:
            description: IDP group id to map onto this team.
            type: string
        type: object
      password:
        description: Will be used to separate team resources.
        type: string
      secrets:
        items:
          $ref: '#/definitions/secret'
        type: array
      services:
        items:
          additionalProperties: false
          properties:
            authz:
              additionalProperties: false
              description: Identifies a workload to authorize.
              properties:
                forwardOriginalToken:
                  default: false
                  description: If true istio will forward the bearer token instead of removing it from the headers.
                  type: boolean
                workload:
                  $ref: '#/definitions/labelsAnnotations'
              type: object
            domain:
              description: A custom service domain name
              type: string
            forwardPath:
              default: false
              description: "Wether to forward the path into the service, or 'terminate' it."
              type: boolean
            id:
              description: Unique identifier created by and used in API. Optional.
              type: string
            internal:
              default: false
              description: 'If true, service is not going to be exposed to the public domain'
              type: boolean
            isPublic:
              default: false
              description: If true then no SSO will be used.
              type: boolean
            isShared:
              description: When true the service will get it's own domain by prefixing the app name to the cluster domain. Mostly used by core apps.
              type: boolean
            ksvc:
              additionalProperties: false
              description: Details for a knative service that will be deployed and operated.
              properties:
                annotations:
                  $ref: '#/definitions/annotations'
                autoCD:
                  additionalProperties: false
                  description: NOT IN USE YET! Deploys new images based on a tagging strategy.
                  oneOf:
                    - additionalProperties: false
                      nullable: true
                      title: 'Off'
                    - nullable: true
                      properties:
                        additionalProperties: false
                        semver:
                          description: 'Use this filter if your images tags follow semantic versioning rules (MAJOR.MINOR.PATCH). E.g.: PATCH only: "~1.1", MINOR and PATCH only "~1", ALL "*"'
                          example: 'PATCH only: "~1.1", MINOR and PATCH only "~1", ALL "*",  ">=1.2.3-0"'
                          title: Semver version pattern
                          type: string
                        tagMatcher:
                          default: semver
                          enum:
                            - semver
                          type: string
                      required:
                        - semver
                      title: Semver versioning
                    - additionalProperties: false
                      properties:
                        glob:
                          description: 'Use this filter if you want to make simple non-standard patterns. E.g.: "master-v1.*.*"'
                          example: master-v1.*.*
                          title: Glob string pattern
                          type: string
                        tagMatcher:
                          default: glob
                          enum:
                            - glob
                          type: string
                      required:
                        - glob
                      title: Glob pattern matching
                  title: Continuous delivery pipeline
                  type: object
                env:
                  items:
                    additionalProperties: false
                    properties:
                      name:
                        $ref: '#/definitions/env'
                      value:
                        maxLength: 131072
                        type: string
                    required:
                      - name
                      - value
                    type: object
                  nullable: true
                  title: Environment variables
                  type: array
                image:
                  $ref: '#/definitions/image'
                predeployed:
                  default: false
                  description: Has this service been predeployed? Otherwise otomi will start it with the configuration given.
                  type: boolean
                resources:
                  $ref: '#/definitions/resources'
                scaleToZero:
                  default: false
                  description: Scales to zero after 60 seconds and needs approximately 8 seconds to start back up.
                  title: Scale to zero
                  type: boolean
                secrets:
                  items:
                    additionalProperties: false
                    properties:
                      entries:
                        items:
                          type: string
                        title: Entries
                        type: array
                        uniqueItems: true
                      name:
                        type: string
                    required:
                      - name
                    type: object
                  nullable: true
                  title: Secrets
                  type: array
              type: object
            name:
              $ref: '#/definitions/idName'
              description: 'Short name. Will be used for generation of knative service name, as well as service URL.'
            ownHost:
              default: true
              description: When true the service will get it's own domain by prefixing the app name to the team domain. Mostly set to true. This will probably be removed soon.
              type: boolean
            paths:
              items:
                description: |
                  Path mapping to only let this path go to the service. This allows micro services to operate on the same domain and port.
                  When left empty all paths will go to this service.
                type: string
              type: array
            port:
              $ref: '#/definitions/portNumber'
              default: 80
              description: Points to the backing k8s service (only used when 'svc' is set).
            svc:
              $ref: '#/definitions/idName'
              description: 'When given a backing k8s service is expected to be deployed with this name, which will be exposed through this team service.'
          required:
            - id
            - name
          type: object
        type: array
    required:
      - id
    type: object
  url:
    pattern: '^(https:\/\/)([\w\-])+\.{1}([a-zA-Z]{2,63})([\/\w-]*)*\/?\??([^#\n\r]*)?#?([^\n\r]*)$'
    type: string
properties:
  azure:
    description: Azure specific configuration
    type: object
    properties:
      diskType:
        type: string
        enum:
          - Standard_LRS
          - Standard_GRS
          - Standard_RAGRS
          - Standard_ZRS
          - Premium_LRS
          - Premium_ZRS
          - Standard_GZRS
          - Standard_RAGZRS
        description: An Azure disk type (SKU Type)
      monitor:
        '$ref': '#/definitions/azureMonitor'
      resourceGroup:
        type: string
        description: An Azure resource group
      subscriptionId:
        type: string
        description: An Azure subscription ID
      tenantId:
        type: string
        description: An Azure tenant ID
    required: [diskType, resourceGroup, subscriptionId, tenantId]
  google:
    description: Google specific configuration
    type: object
    properties:
      cloudDnsKey:
        type: string
        description: A service account key for managing a DNS zone
      projectId:
        type: string
        description: A Google Cloud project ID for accessing DNS zone
    required: [cloudDnsKey, projectId]
  home:
    '$ref': '#/definitions/alerts'
  alerts:
    '$ref': '#/definitions/alerts'
  charts:
    type: object
    additionalProperties: false
    properties:
      jobs:
        type: object
        additionalProperties: false
        patternProperties:
          'certs-aws|harbor|ingress-azure|keycloak':
            type: object
            properties:
              image:
                '$ref': '#/definitions/image'
      cert-manager:
        type: object
        additionalProperties: false
        properties:
          azureClientSecret:
            type: string
          email:
            '$ref': '#/definitions/email'
          provider:
            type: object
            additionalProperties: false
            properties:
              azure:
                type: object
                additionalProperties: false
                properties:
                  azuredns:
                    type: object
                    additionalProperties: false
                    properties:
                      clientID:
                        type: string
                      clientSecretSecretRef:
                        additionalProperties: false
                        properties:
                          key:
                            type: string
                          name:
                            type: string
                        required:
                          - name
                          - key
                        type: object
                      hostedZoneName:
                        type: string
                      resourceGroupName:
                        type: string
                      subscriptionID:
                        type: string
                      tenantID:
                        type: string
                    required:
                      - clientID
                      - clientSecretSecretRef
                      - tenantID
                      - subscriptionID
                      - resourceGroupName
                      - hostedZoneName
              google:
                type: object
                additionalProperties: false
                properties:
                  clouddns:
                    type: object
                    additionalProperties: false
                    properties:
                      project:
                        type: string
                      serviceAccountSecretRef:
                        type: object
                        additionalProperties: false
                        properties:
                          key:
                            type: string
                          name:
                            type: string
              aws:
                type: object
                additionalProperties: false
                properties:
                  route53:
                    type: object
                    additionalProperties: false
                    properties:
                      region:
                        type: string
          stage:
            type: string
            description: |
              The Let’s Encrypt environment that is used for issuing certificates.
              The 'production' environment issues trusted certificates but has narrow rate limits, whereas the 'staging' environment issues untrusted certificates but provides broader rate limits.
              Read more about rate limits: https://letsencrypt.org/docs/rate-limits/
            enum: ['staging', 'production']
      cluster-overprovisioner:
        type: object
        additionalProperties: false
        properties:
          enabled:
            type: boolean
          memory:
            '$ref': '#/definitions/memoryQuantity'
          cpu:
            '$ref': '#/definitions/cpuQuantity'
      drone:
        type: object
        additionalProperties: false
        properties:
          enabled:
            type: boolean
            default: false
          adminUser:
            type: string
          debug:
            type: boolean
            default: false
          sharedSecret:
            type: string
            description: A secret used by drone-admit-members plugin
          githubAdmins:
            type: object
            additionalProperties: false
            properties:
              org:
                type: string
              team:
                type: string
              token:
                type: string
          orgsFilter:
            type: string
          repoFilter:
            type: string
          resources:
            additionalProperties: false
            properties:
              runner:
                '$ref': '#/definitions/resources'
              server:
                '$ref': '#/definitions/resources'
          sourceControl:
            type: object
            additionalProperties: false
            properties:
              github:
                allOf:
                  - '$ref': '#/definitions/droneGit'
                  - properties:
                      server:
                        type: string
                        default: https://github.com
              gitlab:
                allOf:
                  - '$ref': '#/definitions/droneGit'
                  - properties:
                      server:
                        type: string
              gitea:
                allOf:
                  - '$ref': '#/definitions/droneGit'
                  - properties:
                      server:
                        type: string
              gogs:
                properties:
                  server:
                    type: string
              bitbucketCloud:
                '$ref': '#/definitions/droneGit'
              bitbucketServer:
                properties:
                  server:
                    type: string
                  consumerKey:
                    type: string
                    default: consumerKey
                  privateKey:
                    type: string
                    default: privateKey
                  username:
                    type: string
                  passwordKey:
                    type: string
                    default: password
              provider:
                type: string
                enum:
                  - github
                  - gitlab
                  - gitea
                  - gogs
                  - bitbucketCloud
                  - bitbucketServer
                default: github
      external-dns:
        type: object
        additionalProperties: false
        properties:
          aws:
            type: object
            properties:
              region:
                type: string
            required: [region]
          azure:
            type: object
          domainFilters:
            type: array
            items:
              type: string
          logLevel:
            type: string
            enum: [debug, info, warning, error]
            default: info
          zoneIdFilters:
            type: array
            items:
              type: string
      gatekeeper-operator:
        type: object
        additionalProperties: false
        properties:
          enabled:
            type: boolean
      harbor:
        type: object
        additionalProperties: false
        properties:
          adminPassword:
            type: string
          enabled:
            type: boolean
          persistence:
            additionalProperties: false
            type: object
            properties:
              imageChartStorage:
                type: object
                additionalProperties: false
                properties:
                  gcs:
                    type: object
                    additionalProperties: false
                    properties:
                      bucket:
                        type: string
                      encodedkey:
                        type: string
                      rootdirectory:
                        type: string
                  type:
                    type: string
          resources:
            additionalProperties: false
            properties:
              adapter:
                '$ref': '#/definitions/resources'
              chartmuseum:
                '$ref': '#/definitions/resources'
              clair:
                '$ref': '#/definitions/resources'
              controller:
                '$ref': '#/definitions/resources'
              core:
                '$ref': '#/definitions/resources'
              database:
                '$ref': '#/definitions/resources'
              jobservice:
                '$ref': '#/definitions/resources'
              portal:
                '$ref': '#/definitions/resources'
          secretKey:
            type: string
      ingress-azure:
        type: object
        description: A chart for Azure Application Gateway
        additionalProperties: false
        properties:
          appgw:
            additionalProperties: false
            description: Application Gateway
            properties:
              name:
                description: A name of the Application Gateway
                type: string
              usePrivateIP:
                description: Wether to use a private ip range or not
                type: boolean
                default: false
              resourceGroup:
                description: A name of the Azure Resource Group in which Application Gateway was created
                type: string
              subnetName:
                description: A subnet of the application gateway
                type: string
              subnetPrefix:
                description: A subnet in CIDR notation
                examples:
                  - 10.1.0.0/16
                type: string
              subscriptionId:
                description: The Azure Subscription ID in which Application Gateway resides
                type: string
            required:
              - subscriptionId
              - resourceGroup
              - name
              - subnetName
              - subnetPrefix
          armAuth:
            type: object
            additionalProperties: false
            description: A service Principal secret ey An explanation about the purpose of this instance.
            properties:
              secretJSON:
                description: A service Principal secret JSON key (base64 encoded)
                type: string
            required:
              - secretJSON
        required:
          - armAuth
          - appgw

      istio:
        type: object
        additionalProperties: false
        properties:
          addonComponents:
            additionalProperties: false
            properties:
              grafana:
                additionalProperties: false
                properties:
                  enabled:
                    type: boolean
                type: object
              kiali:
                additionalProperties: false
                properties:
                  enabled:
                    type: boolean
                type: object
              prometheus:
                additionalProperties: false
                properties:
                  enabled:
                    type: boolean
                type: object
              tracing:
                additionalProperties: false
                properties:
                  enabled:
                    type: boolean
                type: object
            type: object
          autoscaling:
            properties:
              egressgateway:
                $ref: '#/definitions/scaling'
              gateway-local:
                $ref: '#/definitions/scaling'
              ingressgateway:
                $ref: '#/definitions/scaling'
              ingressgateway-auth:
                $ref: '#/definitions/scaling'
              pilot:
                $ref: '#/definitions/scaling'
            type: object
          egressGateway:
            type: object
            properties:
              enabled:
                type: boolean
                default: false
          global:
            additionalProperties: false
            properties:
              logging:
                properties:
                  level:
                    type: string
                type: object
              mtls:
                additionalProperties: false
                properties:
                  enabled:
                    type: boolean
                type: object
              proxy:
                additionalProperties: false
                properties:
                  resources:
                    $ref: '#/definitions/resources'
                type: object
              sds:
                additionalProperties: false
                properties:
                  enabled:
                    type: boolean
                type: object
            type: object
          resources:
            properties:
              egressgateway:
                $ref: '#/definitions/resources'
              gateway-local:
                $ref: '#/definitions/resources'
              ingressgateway:
                $ref: '#/definitions/resources'
              ingressgateway-auth:
                $ref: '#/definitions/resources'
              pilot:
                $ref: '#/definitions/resources'
            type: object
      kube-descheduler:
        type: object
        additionalProperties: false
        properties:
          enabled:
            type: boolean
            default: true
          schedule:
            type: string
            default: '*/30 * * * *'
      keycloak:
        type: object
        additionalProperties: false
        properties:
          enabled:
            type: boolean
          idp:
            type: object
            additionalProperties: false
            properties:
              alias:
                type: string
              clientID:
                type: string
              clientSecret:
                type: string
          realm:
            type: string
          resources:
            additionalProperties: false
            properties:
              keycloak:
                '$ref': '#/definitions/resources'
              postgresql:
                '$ref': '#/definitions/resources'
          theme:
            type: string
            enum: [default, otomi]
      loki:
        type: object
        additionalProperties: false
        properties:
          adminPassword:
            type: string
          persistence:
            type: object
            additionalProperties: false
            properties:
              size:
                type: string
          retention:
            type: object
            additionalProperties: false
            properties:
              duration:
                type: string
              period:
                type: string
          storageType:
            type: string
      nginx-ingress:
        type: object
        additionalProperties: false
        properties:
          autoscaling:
            type: object
            additionalProperties: false
            properties:
              enabled:
                type: boolean
                default: true
          resources:
            '$ref': '#/definitions/resources'
      oauth2-proxy:
        type: object
        additionalProperties: false
        properties:
          config:
            type: object
            properties:
              cookieSecret:
                type: string
                description: Cookie secret must be 128 bit base64 encoded string.
                pattern: ^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$
      otomi-api:
        type: object
        additionalProperties: false
        properties:
          git:
            type: object
            additionalProperties: false
            properties:
              branch:
                type: string
              email:
                '$ref': '#/definitions/email'
              localPath:
                type: string
              password:
                type: string
              repoUrl:
                '$ref': '#/definitions/repoUrl'
              user:
                type: string
          image:
            '$ref': '#/definitions/imageSimple'
          resources:
            additionalProperties: false
            properties:
              api:
                '$ref': '#/definitions/resources'
              tools:
                '$ref': '#/definitions/resources'
          tools:
            type: object
            additionalProperties: false
            properties:
              gcloudServiceKey:
                type: string
              image:
                '$ref': '#/definitions/imageSimple'

      otomi-console:
        type: object
        additionalProperties: false
        properties:
          image:
            '$ref': '#/definitions/imageSimple'
      prometheus-operator:
        type: object
        properties:
          additionalProperties: false
          grafana:
            type: object
            additionalProperties: false
            properties:
              adminPassword:
                type: string
          prometheus:
            type: object
            additionalProperties: false
            properties:
              storageSize:
                type: string
          resources:
            additionalProperties: false
            properties:
              prometheus:
                '$ref': '#/definitions/resources'
              grafana:
                '$ref': '#/definitions/resources'
      oauth2-proxy-redis:
        type: object
        additionalProperties: false
        properties:
          resources:
            additionalProperties: false
            properties:
              master:
                '$ref': '#/definitions/resources'
              sentinel:
                '$ref': '#/definitions/resources'
              slave:
                '$ref': '#/definitions/resources'
      redis-shared:
        type: object
        additionalProperties: false
        properties:
          enabled:
            type: boolean
          resources:
            additionalProperties: false
            properties:
              master:
                '$ref': '#/definitions/resources'
              sentinel:
                '$ref': '#/definitions/resources'
              slave:
                '$ref': '#/definitions/resources'
      sitespeed:
        type: object
        additionalProperties: false
        properties:
          enabled:
            type: boolean
          pvc:
            type: object
            additionalProperties: false
            properties:
              graphite:
                type: string
              results:
                type: string
          retention:
            type: string
          schedule:
            type: string
      weave-scope:
        enabled: boolean
        default: false
  clouds:
    additionalProperties: false
    type: object
    properties:
      aws:
        '$ref': '#/definitions/cloud'
      azure:
        '$ref': '#/definitions/cloud'
      google:
        '$ref': '#/definitions/cloud'
      onprem:
        '$ref': '#/definitions/cloud'
  customer:
    type: object
    additionalProperties: false
    properties:
      name:
        type: string
  oidc:
    description: Holds many parts used in different locations. Please see keycloak, istio and oauth-proxy all consuming parts.
    type: object
    additionalProperties: false
    properties:
      clientID:
        type: string
      clientSecret:
        type: string
      issuer:
        '$ref': '#/definitions/url'
      jwksUri:
        '$ref': '#/definitions/url'
      authUrl:
        '$ref': '#/definitions/url'
      tokenUrl:
        '$ref': '#/definitions/url'
      apiUrl:
        '$ref': '#/definitions/url'
      tenantID:
        type: string
      scope:
        type: string
      adminGroupID:
        type: string
      teamAdminGroupID:
        type: string
  otomi:
    type: object
    additionalProperties: false
    properties:
      hasCloudLB:
        type: boolean
        description:
          Set this to true when an external LB exists or needs to be started (AWS ALB, Azure AppGW, Google Apigee).
          This will then be configured through ingress controllers. Expects existing LBs to terminate https.
          Currently this is only working correctly for Azure, and not for AWS and Google. AWS is close to completion.
        default: false
      isManaged:
        type: boolean
        description: Wether masters are managed and not under control. Set this to false when onprem.
        default: true
      isMultitenant:
        type: boolean
        description: Wether to separate team metrics and logs. Disabling this lets everybody be admin and see everything.
        default: true
      isHomeMonitored:
        type: boolean
        description: Wether this cluster is home monitored (like when under a Premium SLA). Sends criticals home.
        default: false
      mode:
        type: string
        default: ee
        description: The otomi-core edition. Either community edition (ce) or enterprise edition (ee)
        enum: [ce, ee]
      pullSecret:
        type: string
        description: The pullsecret to deploy the Otomi API and Console. Requires an Otomi license.
        default: ''
      teamPrefix:
        type: string
        default: team-
        description: The prefix to use in URLs for team domains.
        pattern: ^[a-z]+[-]{1}$
  sops:
    description: DON'T EDIT THIS YOURSELF! This is a SOPS governed property. Exists here only to avoid warnings in console.
  teamConfig:
    type: object
    additionalProperties: false
    properties:
      teams:
        type: object
        additionalProperties: false
        patternProperties:
          '^[a-z-]+$':
            '$ref': '#/definitions/team'
      services:
        description: An internal otomi object (do not edit it)
        type: array

  cluster:
    description: An internal otomi object (do not edit it)
    type: object

  k8s:
    type: object
    additionalProperties: false
    properties:
      namespaces:
        type: array
        items:
          type: object
          additionalProperties: false
          properties:
            disableIstioInjection:
              type: boolean
            name:
              type: string
          required:
            - name
    required:
      - namespaces

  proxies:
    type: array
    items:
      type: object
      additionalProperties: false
      properties:
        name:
          type: string
        namespace:
          type: string
        path:
          type: string
      required:
        - name
        - namespace
        - path
  services:
    type: array
    items:
      type: object
      additionalProperties: false
      properties:
        isPublic:
          type: boolean
        name:
          type: string
        namespace:
          type: string
        ownHost:
          type: boolean
        svc:
          type: string
        isShared:
          type: boolean
        paths:
          anyOf:
            - type: 'null'
            - type: array
              items:
                type: string
        forwardPath:
          type: boolean
        hide:
          type: boolean
        port:
          type: integer
        authz:
          type: object
          properties:
            forwardOriginalToken:
              type: boolean
            workload:
              type: object
              properties:
                app.kubernetes.io/name:
                  type: string
                app.kubernetes.io/instance:
                  type: string
                app:
                  type: string
                component:
                  type: string
          required:
            - workload
        host:
          type: string
        path:
          type: string
        logo:
          type: object
          properties:
            name:
              type: string
          required:
            - name
      required:
        - name
        - namespace
        - svc
  smtp:
    type: object
    additionalProperties: false
    properties:
      from:
        description: The "from" address. Defaults to alerts@$clusterDomain.
        '$ref': '#/definitions/email'
      smarthost:
        description: The smtp host:port combination.
        '$ref': '#/definitions/hostPort'
      hello:
        type: string
      auth_username:
        type: string
      auth_password:
        type: string
      auth_secret:
        type: string
      auth_identity:
        type: string
    required: [smarthost]

  toolsVersion:
    type: string

required: [alerts, clouds, customer, oidc, otomi, teamConfig, k8s, services, toolsVersion]
