{{- $v := .Environment.Values -}}
{{- $o := $v.charts | get "cluster-overprovisioner" dict }}
{{- $addIgnorePolicyAnnotation := readFile "../../helmfile.d/utils/addIgnorePolicyAnnotation.gotmpl" }}

deployments:
  - name: default
    resources:
      {{- range $type := (list "limits" "requests") }}
      {{ $type }}:
        cpu: {{ $o | get "cpu" "1000m" }}
        memory: {{ $o | get "memory" "1000Mi" }}
      {{- end }}
    annotations: {{- tpl $addIgnorePolicyAnnotation (dict "policies" (list "psp-allowed-users")) | nindent 6}}