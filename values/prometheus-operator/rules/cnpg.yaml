groups:
  - name: cnpg.rules
    rules:
      - alert: BackupHarborDbFailing
        expr: time() - cnpg_collector_last_failed_backup_timestamp{namespace="harbor",pod=~"harbor-otomi-db-1"} > 86400 or time() - cnpg_collector_last_failed_backup_timestamp{namespace="harbor",pod=~"harbor-otomi-db-2"} > 86400
        labels:
          severity: warning
        annotations:
          description: 'The Harbor database backup for DB {{ $labels.pod }} failed at {{ $value | humanizeTimestamp }}'
          summary: Backup of {{ $labels.pod }} failed
      - alert: BackupKeycloakDbFailing
        expr: time() - cnpg_collector_last_failed_backup_timestamp{namespace="keycloak",pod=~"keycloak-db-1"} > 86400 or time() - cnpg_collector_last_failed_backup_timestamp{namespace="keycloak",pod=~"keycloak-db-2"} > 86400
        labels:
          severity: warning
        annotations:
          description: 'The Keycloak database backup for DB {{ $labels.pod }} failed at {{ $value | humanizeTimestamp }}'
          summary: Backup of {{ $labels.pod }} failed
      - alert: BackupGiteaDbFailing
        expr: time() - cnpg_collector_last_failed_backup_timestamp{namespace="gitea",pod=~"gitea-db-1"} > 86400 or time() - cnpg_collector_last_failed_backup_timestamp{namespace="gitea",pod=~"gitea-db-2"} > 86400
        labels:
          severity: warning
        annotations:
          description: 'The Gitea database backup for DB {{ $labels.pod }} failed at {{ $value | humanizeTimestamp }}'
          summary: Backup of {{ $labels.pod }} failed
