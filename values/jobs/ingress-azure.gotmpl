{{- $v := .Environment.Values }}

tasks:
  ingress-azure:
    type: cronjob
    enabled: {{ eq $v.cluster.provider "azure" }}
    image: otomi/tools:{{ $v.toolsVersion }}
    config:
      LABELS: "app=ingress-azure"
      NS: ingress
    schedule: "0 * * * *" # once an hour!
    serviceAccountName: cluster-maintainer
    script: |
      {{- readFile "scripts/delete-pod.sh" | nindent 6 }}
