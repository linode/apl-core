{{- $v := .Environment.Values }}
{{- $c := $v.charts }}
{{- $ns := $v.cluster.hasCloudLB | ternary "ingress" "istio-system" }}
tasks:
  harbor-init:
    type: job
    enabled: true
    description: Copy letsencrypt cert
    image: otomi/tools:{{ $v.toolsVersion }}
    script: kubectl -n {{ $ns }} get secret harbor-{{ $v.cluster.domain | replace "." "-" }} -o yaml --export | kubectl -n harbor apply -f -
