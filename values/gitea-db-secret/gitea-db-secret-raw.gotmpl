{{- $v := .Values }}

resources:
- apiVersion: external-secrets.io/v1beta1
  kind: ExternalSecret
  metadata:
    name: gitea-db-secret
  spec:
    refreshInterval: 1h
    secretStoreRef:
      name: core-secrets-store
      kind: ClusterSecretStore
    target:
      name: gitea-db-secret
      creationPolicy: Owner
      template:
        type: kubernetes.io/basic-auth
        data:
          username: {{ "gitea" | b64enc }}
          password: '{{ "{{ .postgresqlPassword | base64encode }}" }}'
    data:
      - secretKey: postgresqlPassword
        remoteRef:
          key: gitea-secrets
          property: postgresqlPassword
